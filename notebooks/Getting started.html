<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>Getting started</title>
    
      <link rel="stylesheet" href="../_static/pygments.css">
      <link rel="stylesheet" href="../_static/theme.css">
      <link rel="stylesheet" href="../_static/romnnn_sphinx_press_theme.css">
          <link rel="stylesheet" href="../_static/style.css" type="text/css" />
      
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>

      
      <script src="../_static/theme-vendors.js"></script>
      <script src="../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Choosing the correct frequencies" href="Estimating frequencies.html" />
  <link rel="prev" title="API" href="../api/api.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <div class="home-link-container">
      <router-link to="../index.html" class="home-link">
      
        <span class="site-name">maelstrom</span>
    </router-link>
  </div>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../index.html#maelstrom"
         class="nav-link ">
         User Guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#maelstrom"
         class="nav-link  router-link-active">
         Tutorials
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#maelstrom"
         class="nav-link ">
         Case studies
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../index.html#maelstrom"
         class="nav-link ">
         User Guide
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#maelstrom"
         class="nav-link  router-link-active">
         Tutorials
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#maelstrom"
         class="nav-link ">
         Case studies
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Search</span>
    <div class="searchformwrapper">
      <form autocomplete="off" class="search" action="../search.html" method="get">
        <input type="text" name="q" autocomplete="off" />
        <input type="submit" value="Go" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#maelstrom">User Guide</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../user/install.html" class="reference internal ">Installation</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../user/citation.html" class="reference internal ">Citing</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../api/api.html" class="reference internal ">API</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#maelstrom">Tutorials</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Getting started</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#Getting-started" class="reference internal">Getting started</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="Estimating frequencies.html" class="reference internal ">Choosing the correct frequencies</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="Custom priors.html" class="reference internal ">Custom priors</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#maelstrom">Case studies</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../case_studies/9651065.html" class="reference internal ">KIC 9651065</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../case_studies/6780873.html" class="reference internal ">KIC 6780873</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../case_studies/10080943.html" class="reference internal ">KIC 10080943</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
    <li>Getting started</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../api/api.html"
       title="previous chapter">← API</a>
  </li>
  <li class="next">
    <a href="Estimating frequencies.html"
       title="next chapter">Choosing the correct frequencies →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Getting-started">
<h1>Getting started<a class="headerlink" href="#Getting-started" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">exoplanet</span> <span class="k">as</span> <span class="nn">xo</span>
<span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">config</span> IPython.matplotlib.backend = &quot;retina&quot;
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;savefig.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
</pre></div>
</div>
</div>
<p>Let’s download a nice star that has good time-delays – KIC 9651065.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lc</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_lightcurvefile</span><span class="p">(</span><span class="s1">&#39;KIC 9651065&#39;</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="s1">&#39;Kepler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">download_all</span><span class="p">()</span><span class="o">.</span><span class="n">PDCSAP_FLUX</span><span class="o">.</span><span class="n">stitch</span><span class="p">()</span><span class="o">.</span><span class="n">remove_nans</span><span class="p">()</span>
<span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1118c1f28&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_4_1.png" src="../_images/notebooks_Getting_started_4_1.png" />
</div>
</div>
<p>Here, we pass the time and flux data into Maelstrom. Note that lightkurve automatically subtracts the Kepler zero time (2454844 days). If you want to include additional data, you must work within the same reference time. If the <code class="docutils literal notranslate"><span class="pre">freq</span></code> argument is not specified, Maelstrom will automatically try and detect some good peaks. Be warned however, this does not always work and you should always check which frequencies you use! I have set the upper limit on the peak search to 40 cpd, since there are
some Nyquist aliases. We can tell they are aliases as their time delays will match the Kepler orbital period. Neat!</p>
<p>First look will subdivide the lightcurve using the old method, and have a quick look at the orbital signal. The frequencies are colored by their amplitude, and the orange line is the weighted average value. We see a nice peak around 272 d, which is the orbital period.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">maelstrom</span> <span class="kn">import</span> <span class="n">Maelstrom</span>

<span class="n">ms</span> <span class="o">=</span> <span class="n">Maelstrom</span><span class="p">(</span><span class="n">lc</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">lc</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">max_peaks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">ms</span><span class="o">.</span><span class="n">first_look</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c1a7f4518&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c21fb4da0&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c1b3cc390&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c1b3f6940&gt;],
      dtype=object)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_6_1.png" src="../_images/notebooks_Getting_started_6_1.png" />
</div>
</div>
<p>To read off this period, we can calculate the peak in the power spectrum of the time delays (the bottom left panel above)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">period_guess</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_period_estimate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">period_guess</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
269.95909667504344
</pre></div></div>
</div>
<p>Let’s now perform an initial optimisation.. We first need to call <code class="docutils literal notranslate"><span class="pre">setup_orbit_model</span></code>, but an orbital period estimate is not required (unless the time delay signal is very weak..!). We can also pass along an initial guess for the eccentricity, but let’s leave it at 0 and see what happens.</p>
<p>We then optimize the model</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ms</span><span class="o">.</span><span class="n">setup_orbit_model</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period_guess</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">opt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;logperiod&#39;: array(5.60521922),
 &#39;t0&#39;: array(15.39716591),
 &#39;varpi_angle__&#39;: array([ 3.64010862, -2.59799919]),
 &#39;eccen_interval__&#39;: array(-0.19682975),
 &#39;logs&#39;: array(0.21291598),
 &#39;lighttime&#39;: array([178.34565426, 191.30015751, 193.97131511]),
 &#39;mean_flux&#39;: array(0.00075224),
 &#39;W_hat_cos&#39;: array([ 1.7414353 ,  0.46678714, -0.59316665]),
 &#39;W_hat_sin&#39;: array([ 0.2940882 ,  0.62832883, -0.28794189]),
 &#39;period&#39;: array(271.84151162),
 &#39;varpi&#39;: array(2.19066763),
 &#39;eccen&#39;: array(0.4509518),
 &#39;tref&#39;: array(24.82834397)}
</pre></div>
</div>
</div>
<p>Let’s see what the theoretical time delays look like in the optimised model vs the actual extracted values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">td_time</span><span class="p">,</span> <span class="n">td_td</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_time_delay</span><span class="p">()</span>
<span class="n">td_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">td_td</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">get_weights</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: AstropyDeprecationWarning: Importing LombScargle from astropy.stats has been deprecated and will no longer be supported in future. Please import this class from the astropy.timeseries module instead [astropy.stats.lombscargle]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">ms</span><span class="p">:</span>
    <span class="n">model_td</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">tau</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span> <span class="o">*</span> <span class="mi">86400</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">model_td</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">model_td</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">td_time</span><span class="p">,</span> <span class="n">td_average</span><span class="p">,</span> <span class="s1">&#39;.k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [day]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time delay [s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0, 0.5, &#39;Time delay [s]&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_14_1.png" src="../_images/notebooks_Getting_started_14_1.png" />
</div>
</div>
<p>Cool! Each frequency in the light curve has its own independent <code class="docutils literal notranslate"><span class="pre">asini</span></code> in the Maelstrom model. This is useful for when there are multiple stars pulsating in the same binary system, as they would be (mostly) equal and opposite in sign.</p>
<p>However, Maelstrom isn’t actually fitting these parameters. What we’re doing is forward modelling the input light curve by fitting the phase variations (<span class="math notranslate nohighlight">\(\tau\)</span>) in each point;</p>
<p><span class="math notranslate nohighlight">\(y(t) = \sum_{j=1}^{J} \Big[A_j \cos(\omega_j (t - \tau)) + B_j \sin(\omega_j (t-\tau))\Big]\)</span></p>
<p>Although it is not as useful as looking at the time-delays, we can still inspect the actual light curve that is generated from the time delay signal:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">ms</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">lc_model</span><span class="p">,</span> <span class="n">opt</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maelstrom&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">205</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [day]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [ppt]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x1c43c6ac18&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_19_1.png" src="../_images/notebooks_Getting_started_19_1.png" />
</div>
</div>
<p>Maelstrom has decided that all these frequencies belong to one star, as their lighttimes are all positive (or negative). This means the system is PB1. We can get a ready-made model from the get go by asking nicely, and passing in the optimisation results. The PB1 model is for binaries with only one pulsating component. All the frequencies now use the same <code class="docutils literal notranslate"><span class="pre">asini</span></code> parameter, unlike our first model</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pb1_model</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">pin_orbit_model</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
<span class="n">pb1_model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$$
            \begin{array}{rcl}
            \text{PB1_logs_lc} &amp;\sim &amp; \text{Normal}(\mathit{mu}=0.6424636244773865,~\mathit{sigma}=10.0)\\\text{PB1_mean} &amp;\sim &amp; \text{Normal}(\mathit{mu}=4.582359380833623e-08,~\mathit{sigma}=1.0)\\\text{PB1_lognu} &amp;\sim &amp; \text{Normal}(\mathit{mu}=array,~\mathit{sigma}=0.1)\\\text{PB1_logpower} &amp;\sim &amp; \text{Normal}(\mathit{mu}=1.2849271297454834,~\mathit{sigma}=10.0)\\\text{PB1_period} &amp;\sim &amp; \text{Deterministic}(\text{Constant},~\text{Constant},~\text{PB1_logP_interval__},~\text{Constant})\\\text{PB1_asini} &amp;\sim &amp; \text{Deterministic}(\text{Constant},~\text{Constant},~\text{PB1_logasini_interval__},~\text{Constant})\\\text{PB1_nu} &amp;\sim &amp; \text{Deterministic}(\text{PB1_lognu})\\\text{PB1_eccen} &amp;\sim &amp; \text{Uniform}(\mathit{lower}=0.0,~\mathit{upper}=0.9)\\\text{PB1_logS0} &amp;\sim &amp; \text{Deterministic}(\text{PB1_logpower},~\text{Constant},~\text{Constant},~\text{Constant},~\text{PB1_logw0_interval__},~\text{Constant})
            \end{array}
            $$</div></div>
</div>
<p>As we can see, pb1_model inherits from the PyMC3 Models object. It is, by definition, a custom model which has access to all of the properties of the default Model class. This means we can do cool things like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pm</span><span class="o">.</span><span class="n">model_to_graphviz</span><span class="p">(</span><span class="n">pb1_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_23_0.svg" src="../_images/notebooks_Getting_started_23_0.svg" /></div>
</div>
<p>Finally, if we are happy with the default priors in Maelstrom we can sample the model. There are strong covariances between some of the parameters. This means that sampling will slow down significantly unless we use a custom NUTS step (see <a class="reference external" href="https://exoplanet.dfm.io/en/stable/tutorials/pymc3-extras/#dense-mass-matrices">https://exoplanet.dfm.io/en/stable/tutorials/pymc3-extras/#dense-mass-matrices</a>)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb1_model</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">xo</span><span class="o">.</span><span class="n">get_dense_nuts_step</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [PB1_logpower, PB1_logw0, PB1_eccen, PB1_omega, PB1_lognu, PB1_mean, PB1_logasini, PB1_logs_lc, PB1_phi, PB1_logP]
Sampling 2 chains:   1%|          | 22/4000 [01:39&lt;5:00:49,  4.54s/draws]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_mp_sample</span><span class="ansi-blue-fg">(draws, tune, step, chains, cores, chain, random_seed, start, progressbar, trace, model, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    968</span>             <span class="ansi-green-fg">with</span> sampler<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 969</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">for</span> draw <span class="ansi-green-fg">in</span> sampler<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    970</span>                     trace <span class="ansi-blue-fg">=</span> traces<span class="ansi-blue-fg">[</span>draw<span class="ansi-blue-fg">.</span>chain <span class="ansi-blue-fg">-</span> chain<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/parallel_sampling.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    392</span>         <span class="ansi-green-fg">while</span> self<span class="ansi-blue-fg">.</span>_active<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 393</span><span class="ansi-red-fg">             </span>draw <span class="ansi-blue-fg">=</span> ProcessAdapter<span class="ansi-blue-fg">.</span>recv_draw<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_active<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    394</span>             proc<span class="ansi-blue-fg">,</span> is_last<span class="ansi-blue-fg">,</span> draw<span class="ansi-blue-fg">,</span> tuning<span class="ansi-blue-fg">,</span> stats<span class="ansi-blue-fg">,</span> warns <span class="ansi-blue-fg">=</span> draw

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/parallel_sampling.py</span> in <span class="ansi-cyan-fg">recv_draw</span><span class="ansi-blue-fg">(processes, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    283</span>         pipes <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>proc<span class="ansi-blue-fg">.</span>_msg_pipe <span class="ansi-green-fg">for</span> proc <span class="ansi-green-fg">in</span> processes<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 284</span><span class="ansi-red-fg">         </span>ready <span class="ansi-blue-fg">=</span> multiprocessing<span class="ansi-blue-fg">.</span>connection<span class="ansi-blue-fg">.</span>wait<span class="ansi-blue-fg">(</span>pipes<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    285</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> ready<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/multiprocessing/connection.py</span> in <span class="ansi-cyan-fg">wait</span><span class="ansi-blue-fg">(object_list, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    919</span>             <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 920</span><span class="ansi-red-fg">                 </span>ready <span class="ansi-blue-fg">=</span> selector<span class="ansi-blue-fg">.</span>select<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    921</span>                 <span class="ansi-green-fg">if</span> ready<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/selectors.py</span> in <span class="ansi-cyan-fg">select</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    414</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 415</span><span class="ansi-red-fg">             </span>fd_event_list <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_selector<span class="ansi-blue-fg">.</span>poll<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    416</span>         <span class="ansi-green-fg">except</span> InterruptedError<span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>:

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-25-9e096008b28d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">with</span> pb1_model<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     trace = pm.sample(
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">         </span>tune<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">,</span> draws<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">,</span> step<span class="ansi-blue-fg">=</span>xo<span class="ansi-blue-fg">.</span>get_dense_nuts_step<span class="ansi-blue-fg">(</span>target_accept<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0.95</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     )

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">sample</span><span class="ansi-blue-fg">(draws, step, init, n_init, start, trace, chain_idx, chains, cores, tune, progressbar, model, random_seed, discard_tuned_samples, compute_convergence_checks, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    435</span>             _print_step_hierarchy<span class="ansi-blue-fg">(</span>step<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    436</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 437</span><span class="ansi-red-fg">                 </span>trace <span class="ansi-blue-fg">=</span> _mp_sample<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>sample_args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    438</span>             <span class="ansi-green-fg">except</span> pickle<span class="ansi-blue-fg">.</span>PickleError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    439</span>                 _log<span class="ansi-blue-fg">.</span>warning<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Could not pickle model, sampling singlethreaded.&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_mp_sample</span><span class="ansi-blue-fg">(draws, tune, step, chains, cores, chain, random_seed, start, progressbar, trace, model, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    989</span>         <span class="ansi-green-fg">return</span> MultiTrace<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    990</span>     <span class="ansi-green-fg">except</span> KeyboardInterrupt<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 991</span><span class="ansi-red-fg">         </span>traces<span class="ansi-blue-fg">,</span> length <span class="ansi-blue-fg">=</span> _choose_chains<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">,</span> tune<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    992</span>         <span class="ansi-green-fg">return</span> MultiTrace<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>length<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    993</span>     <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_choose_chains</span><span class="ansi-blue-fg">(traces, tune)</span>
<span class="ansi-green-intense-fg ansi-bold">   1005</span>     lengths <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>max<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> len<span class="ansi-blue-fg">(</span>trace<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> tune<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> trace <span class="ansi-green-fg">in</span> traces<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">   1006</span>     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> sum<span class="ansi-blue-fg">(</span>lengths<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1007</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Not enough samples to build a trace.&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1008</span>
<span class="ansi-green-intense-fg ansi-bold">   1009</span>     idxs <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>argsort<span class="ansi-blue-fg">(</span>lengths<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span>

<span class="ansi-red-fg">ValueError</span>: Not enough samples to build a trace.
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../api/api.html"
       title="previous chapter">← API</a>
  </li>
  <li class="next">
    <a href="Estimating frequencies.html"
       title="next chapter">Choosing the correct frequencies →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2019, Daniel Hey.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1 with <a href="https://github.com/romnnn/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>