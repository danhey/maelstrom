

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting started &mdash; maelstrom 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Choosing the correct frequencies" href="Estimating frequencies.html" />
    <link rel="prev" title="Citing" href="../user/citation.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> maelstrom
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../user/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/citation.html">Citing</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Estimating frequencies.html">Choosing the correct frequencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="Custom priors.html">Custom priors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">Maelstrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html#module-maelstrom.orbit">Orbit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html#periodogram">Periodogram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html#module-maelstrom.utils">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html#synthetic-light-curves">Synthetic light curves</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">maelstrom</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Getting started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/notebooks/Getting started.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Getting-started">
<h1>Getting started<a class="headerlink" href="#Getting-started" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">config</span> IPython.matplotlib.backend = &quot;retina&quot;
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;savefig.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>

<span class="c1"># import maelstrom as ms</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">exoplanet</span> <span class="k">as</span> <span class="nn">xo</span>
<span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
</pre></div>
</div>
</div>
<p>Let’s download a nice star that has good time-delays – KIC 9651065.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lc</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_lightcurvefile</span><span class="p">(</span><span class="s1">&#39;KIC 9651065&#39;</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="s1">&#39;Kepler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">download_all</span><span class="p">()</span><span class="o">.</span><span class="n">stitch</span><span class="p">()</span><span class="o">.</span><span class="n">remove_nans</span><span class="p">()</span>
<span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/danielhey/anaconda3/lib/python3.7/site-packages/lightkurve/collections.py:212: LightkurveWarning: Stitching a `LightCurveFileCollection` which contains both SAP and PDCSAP_FLUX. Plotting PDCSAP_FLUX. You can remove this warning by using `LightCurveFileCollection.PDCSAP_FLUX.stitch()`.
  LightkurveWarning)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x113e3f160&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_3_2.png" src="../_images/notebooks_Getting_started_3_2.png" />
</div>
</div>
<p>Here, we pass the time and flux data into Maelstrom. Note that lightkurve automatically subtracts the Kepler zero time (2454844 days). If you want to include additional data, you must work within the same reference time. If the <code class="docutils literal notranslate"><span class="pre">freq</span></code> argument is not specified, Maelstrom will automatically try and detect some good peaks. Be warned however, this does not always work and you should always check which frequencies you use! I have set the upper limit on the peak search to 40 cpd, since there are
some Nyquist aliases. We can tell they are aliases as their time delays will match the Kepler orbital period. Neat!</p>
<p>First look will subdivide the lightcurve using the old method, and have a quick look at the orbital signal. The frequencies are colored by their amplitude, and the orange line is the weighted average value. We see a nice peak around 272 d, which is the orbital period.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">maelstrom</span> <span class="k">import</span> <span class="n">Maelstrom</span>

<span class="n">ms</span> <span class="o">=</span> <span class="n">Maelstrom</span><span class="p">(</span><span class="n">lc</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">lc</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">max_peaks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">ms</span><span class="o">.</span><span class="n">first_look</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: AstropyDeprecationWarning: Importing LombScargle from astropy.stats has been deprecated and will no longer be supported in future. Please import this class from the astropy.timeseries module instead [astropy.stats.lombscargle]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c1db287f0&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c1d73aba8&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c1d775198&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c1d7a1748&gt;],
      dtype=object)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_5_2.png" src="../_images/notebooks_Getting_started_5_2.png" />
</div>
</div>
<p>Let’s now perform an initial optimisation.. We first need to call <code class="docutils literal notranslate"><span class="pre">setup_orbit_model</span></code>, but an orbital period estimate is not required (unless the time delay signal is very weak..!). We then optimize the model</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ms</span><span class="o">.</span><span class="n">setup_orbit_model</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">272.</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">opt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;logperiod&#39;: array(5.60521921),
 &#39;t0&#39;: array(15.39716148),
 &#39;varpi_angle__&#39;: array([ 3.64011013, -2.59799886]),
 &#39;eccen_interval__&#39;: array(-0.19682943),
 &#39;logs&#39;: array(0.21291598),
 &#39;lighttime&#39;: array([178.34565494, 191.3003582 , 193.97127067]),
 &#39;mean_flux&#39;: array(0.00075224),
 &#39;W_hat_cos&#39;: array([ 1.7414353 ,  0.46678729, -0.59316665]),
 &#39;W_hat_sin&#39;: array([ 0.29408812,  0.62832871, -0.28794188]),
 &#39;period&#39;: array(271.84151029),
 &#39;varpi&#39;: array(2.19066738),
 &#39;eccen&#39;: array(0.45095187),
 &#39;tref&#39;: array(24.82833308)}
</pre></div>
</div>
</div>
<p>Let’s see what the theoretical time delays look like</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">ms</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">tau</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [day]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time delay [s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0, 0.5, &#39;Time delay [s]&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_10_1.png" src="../_images/notebooks_Getting_started_10_1.png" />
</div>
</div>
<p>Cool! Each frequency in the light curve has its own independent <code class="docutils literal notranslate"><span class="pre">asini</span></code> in the Maelstrom model. This is useful for when there are multiple stars pulsating in the same binary system, as they would be (mostly) equal and opposite in sign.</p>
<p>Maelstrom has decided that all these frequencies belong to one star, as their lighttimes are all positive (or negative). This means the system is PB1. We can get a ready-made model from the get go by asking nicely, and passing in the optimisation results. The PB1 model is for binaries with only one pulsating component. All the frequencies now use the same <code class="docutils literal notranslate"><span class="pre">asini</span></code> parameter, unlike our first model</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pb1_model</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">pin_orbit_model</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
<span class="n">pb1_model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$$
            \begin{array}{rcl}
            \text{PB1_logs_lc} &amp;\sim &amp; \text{Normal}(\mathit{mu}=0.6424636244773865,~\mathit{sigma}=10.0)\\\text{PB1_mean} &amp;\sim &amp; \text{Normal}(\mathit{mu}=4.582359380833623e-08,~\mathit{sigma}=1.0)\\\text{PB1_lognu} &amp;\sim &amp; \text{Normal}(\mathit{mu}=array,~\mathit{sigma}=0.1)\\\text{PB1_logpower} &amp;\sim &amp; \text{Normal}(\mathit{mu}=1.2849271297454834,~\mathit{sigma}=10.0)\\\text{PB1_period} &amp;\sim &amp; \text{Deterministic}(\text{Constant},~\text{Constant},~\text{PB1_logP_interval__},~\text{Constant})\\\text{PB1_asini} &amp;\sim &amp; \text{Deterministic}(\text{Constant},~\text{Constant},~\text{PB1_logasini_interval__},~\text{Constant})\\\text{PB1_nu} &amp;\sim &amp; \text{Deterministic}(\text{PB1_lognu})\\\text{PB1_eccen} &amp;\sim &amp; \text{Uniform}(\mathit{lower}=0.0,~\mathit{upper}=0.9)\\\text{PB1_logS0} &amp;\sim &amp; \text{Deterministic}(\text{PB1_logpower},~\text{Constant},~\text{Constant},~\text{Constant},~\text{PB1_logw0_interval__},~\text{Constant})
            \end{array}
            $$</div></div>
</div>
<p>As we can see, pb1_model inherits from the PyMC3 Models object. It is, by definition, a custom model which has access to all of the properties of the default Model class. This means we can do cool things like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pm</span><span class="o">.</span><span class="n">model_to_graphviz</span><span class="p">(</span><span class="n">pb1_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Getting_started_15_0.svg" src="../_images/notebooks_Getting_started_15_0.svg" /></div>
</div>
<p>Finally, if we are happy with the default priors in Maelstrom we can sample the model. Otherwise, see the tutorial on setting up custom priors!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">trace</span> <span class="o">=</span> <span class="n">pb1_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
optimizing logp for variables: [PB1_mean]
5it [00:00, 19.64it/s, logp=-1.124302e+05]
message: Optimization terminated successfully.
logp: -112430.23569362523 -&gt; -112430.23430331374
optimizing logp for variables: [PB1_logs_lc]
9it [00:00, 22.53it/s, logp=-1.090380e+05]
message: Optimization terminated successfully.
logp: -112430.23430331374 -&gt; -109037.96061965273
optimizing logp for variables: [PB1_logw0, PB1_logpower]
126it [00:05, 21.60it/s, logp=-1.072571e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -109037.96061965273 -&gt; -107257.13376770144
optimizing logp for variables: [PB1_omega, PB1_eccen]
138it [00:07, 18.96it/s, logp=-1.039395e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -107257.13376770144 -&gt; -103939.50240136718
optimizing logp for variables: [PB1_phi]
21it [00:01, 12.63it/s, logp=-1.039178e+05]
message: Optimization terminated successfully.
logp: -103939.50240136718 -&gt; -103917.84577691373
optimizing logp for variables: [PB1_lognu]
82it [00:07, 11.55it/s, logp=-1.039153e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -103917.84577691373 -&gt; -103915.30544660776
optimizing logp for variables: [PB1_logpower, PB1_logw0, PB1_eccen, PB1_omega, PB1_lognu, PB1_mean, PB1_logasini, PB1_logs_lc, PB1_phi, PB1_logP]
252it [00:27,  9.27it/s, logp=-1.036818e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -103915.30544660776 -&gt; -103681.78180621586
optimizing logp for variables: [PB1_logasini]
3it [00:00,  8.35it/s, logp=-1.036818e+05]
message: Optimization terminated successfully.
logp: -103681.78180621586 -&gt; -103681.78180621586
optimizing logp for variables: [PB1_logpower, PB1_logw0, PB1_eccen, PB1_omega, PB1_lognu, PB1_mean, PB1_logasini, PB1_logs_lc, PB1_phi, PB1_logP]
60it [00:08,  7.00it/s, logp=-1.036818e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -103681.78180621586 -&gt; -103681.78180621554
optimizing logp for variables: [PB1_logP]
3it [00:00,  7.83it/s, logp=-1.036818e+05]
message: Optimization terminated successfully.
logp: -103681.78180621554 -&gt; -103681.78180621554
optimizing logp for variables: [PB1_logpower, PB1_logw0, PB1_eccen, PB1_omega, PB1_lognu, PB1_mean, PB1_logasini, PB1_logs_lc, PB1_phi, PB1_logP]
59it [00:05, 10.07it/s, logp=-1.062195e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -103681.78180621554 -&gt; -103681.78180621554
Sampling 2 chains: 100%|██████████| 104/104 [17:50&lt;00:00, 10.29s/draws]
Sampling 2 chains:  21%|██        | 22/104 [01:48&lt;06:45,  4.95s/draws]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_mp_sample</span><span class="ansi-blue-fg">(draws, tune, step, chains, cores, chain, random_seed, start, progressbar, trace, model, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    968</span>             <span class="ansi-green-fg">with</span> sampler<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 969</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">for</span> draw <span class="ansi-green-fg">in</span> sampler<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    970</span>                     trace <span class="ansi-blue-fg">=</span> traces<span class="ansi-blue-fg">[</span>draw<span class="ansi-blue-fg">.</span>chain <span class="ansi-blue-fg">-</span> chain<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/parallel_sampling.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    392</span>         <span class="ansi-green-fg">while</span> self<span class="ansi-blue-fg">.</span>_active<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 393</span><span class="ansi-red-fg">             </span>draw <span class="ansi-blue-fg">=</span> ProcessAdapter<span class="ansi-blue-fg">.</span>recv_draw<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_active<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    394</span>             proc<span class="ansi-blue-fg">,</span> is_last<span class="ansi-blue-fg">,</span> draw<span class="ansi-blue-fg">,</span> tuning<span class="ansi-blue-fg">,</span> stats<span class="ansi-blue-fg">,</span> warns <span class="ansi-blue-fg">=</span> draw

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/parallel_sampling.py</span> in <span class="ansi-cyan-fg">recv_draw</span><span class="ansi-blue-fg">(processes, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    283</span>         pipes <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>proc<span class="ansi-blue-fg">.</span>_msg_pipe <span class="ansi-green-fg">for</span> proc <span class="ansi-green-fg">in</span> processes<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 284</span><span class="ansi-red-fg">         </span>ready <span class="ansi-blue-fg">=</span> multiprocessing<span class="ansi-blue-fg">.</span>connection<span class="ansi-blue-fg">.</span>wait<span class="ansi-blue-fg">(</span>pipes<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    285</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> ready<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/multiprocessing/connection.py</span> in <span class="ansi-cyan-fg">wait</span><span class="ansi-blue-fg">(object_list, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    919</span>             <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 920</span><span class="ansi-red-fg">                 </span>ready <span class="ansi-blue-fg">=</span> selector<span class="ansi-blue-fg">.</span>select<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    921</span>                 <span class="ansi-green-fg">if</span> ready<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/selectors.py</span> in <span class="ansi-cyan-fg">select</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    414</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 415</span><span class="ansi-red-fg">             </span>fd_event_list <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_selector<span class="ansi-blue-fg">.</span>poll<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    416</span>         <span class="ansi-green-fg">except</span> InterruptedError<span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>:

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-17-e3cd2a89910d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>trace <span class="ansi-blue-fg">=</span> pb1_model<span class="ansi-blue-fg">.</span>sample<span class="ansi-blue-fg">(</span>tune<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">,</span> draws<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Dropbox (Sydney Uni)/maelstrom/maelstrom/maelstrom.py</span> in <span class="ansi-cyan-fg">sample</span><span class="ansi-blue-fg">(self, tune, draws, start, target_accept, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    128</span>         <span class="ansi-green-fg">with</span> self<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>             sampler.tune(tune=tune, start=start, **kwargs,
<span class="ansi-green-fg">--&gt; 130</span><span class="ansi-red-fg">                                   step_kwargs=dict(target_accept=target_accept))
</span><span class="ansi-green-intense-fg ansi-bold">    131</span>             trace <span class="ansi-blue-fg">=</span> sampler<span class="ansi-blue-fg">.</span>sample<span class="ansi-blue-fg">(</span>draws<span class="ansi-blue-fg">=</span>draws<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    132</span>         <span class="ansi-green-fg">return</span> trace

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/exoplanet/sampling.py</span> in <span class="ansi-cyan-fg">tune</span><span class="ansi-blue-fg">(self, tune, start, step_kwargs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    214</span>                 steps<span class="ansi-blue-fg">=</span>steps<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    215</span>                 trace<span class="ansi-blue-fg">=</span>trace<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 216</span><span class="ansi-red-fg">                 </span><span class="ansi-blue-fg">**</span>kwargs
<span class="ansi-green-intense-fg ansi-bold">    217</span>             )
<span class="ansi-green-intense-fg ansi-bold">    218</span>             steps <span class="ansi-blue-fg">*=</span> <span class="ansi-cyan-fg">2</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/exoplanet/sampling.py</span> in <span class="ansi-cyan-fg">extend_tune</span><span class="ansi-blue-fg">(self, steps, start, step_kwargs, trace, step, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    181</span>             start<span class="ansi-blue-fg">=</span>start<span class="ansi-blue-fg">,</span> step_kwargs<span class="ansi-blue-fg">=</span>step_kwargs<span class="ansi-blue-fg">,</span> trace<span class="ansi-blue-fg">=</span>trace<span class="ansi-blue-fg">,</span> step<span class="ansi-blue-fg">=</span>step
<span class="ansi-green-intense-fg ansi-bold">    182</span>         )
<span class="ansi-green-fg">--&gt; 183</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_extend<span class="ansi-blue-fg">(</span>steps<span class="ansi-blue-fg">,</span> start<span class="ansi-blue-fg">=</span>start<span class="ansi-blue-fg">,</span> step<span class="ansi-blue-fg">=</span>step<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    184</span>         self<span class="ansi-blue-fg">.</span>_current_step <span class="ansi-blue-fg">=</span> step
<span class="ansi-green-intense-fg ansi-bold">    185</span>         <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_current_trace

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/exoplanet/sampling.py</span> in <span class="ansi-cyan-fg">_extend</span><span class="ansi-blue-fg">(self, steps, start, step, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    126</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>         self._current_trace = pm.sample(
<span class="ansi-green-fg">--&gt; 128</span><span class="ansi-red-fg">             </span>start<span class="ansi-blue-fg">=</span>start<span class="ansi-blue-fg">,</span> tune<span class="ansi-blue-fg">=</span>steps<span class="ansi-blue-fg">,</span> step<span class="ansi-blue-fg">=</span>step<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs
<span class="ansi-green-intense-fg ansi-bold">    129</span>         )
<span class="ansi-green-intense-fg ansi-bold">    130</span>         self<span class="ansi-blue-fg">.</span>count <span class="ansi-blue-fg">+=</span> steps

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">sample</span><span class="ansi-blue-fg">(draws, step, init, n_init, start, trace, chain_idx, chains, cores, tune, progressbar, model, random_seed, discard_tuned_samples, compute_convergence_checks, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    435</span>             _print_step_hierarchy<span class="ansi-blue-fg">(</span>step<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    436</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 437</span><span class="ansi-red-fg">                 </span>trace <span class="ansi-blue-fg">=</span> _mp_sample<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>sample_args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    438</span>             <span class="ansi-green-fg">except</span> pickle<span class="ansi-blue-fg">.</span>PickleError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    439</span>                 _log<span class="ansi-blue-fg">.</span>warning<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Could not pickle model, sampling singlethreaded.&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_mp_sample</span><span class="ansi-blue-fg">(draws, tune, step, chains, cores, chain, random_seed, start, progressbar, trace, model, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    989</span>         <span class="ansi-green-fg">return</span> MultiTrace<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    990</span>     <span class="ansi-green-fg">except</span> KeyboardInterrupt<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 991</span><span class="ansi-red-fg">         </span>traces<span class="ansi-blue-fg">,</span> length <span class="ansi-blue-fg">=</span> _choose_chains<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">,</span> tune<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    992</span>         <span class="ansi-green-fg">return</span> MultiTrace<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>length<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    993</span>     <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_choose_chains</span><span class="ansi-blue-fg">(traces, tune)</span>
<span class="ansi-green-intense-fg ansi-bold">   1005</span>     lengths <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>max<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> len<span class="ansi-blue-fg">(</span>trace<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> tune<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> trace <span class="ansi-green-fg">in</span> traces<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">   1006</span>     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> sum<span class="ansi-blue-fg">(</span>lengths<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1007</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Not enough samples to build a trace.&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1008</span>
<span class="ansi-green-intense-fg ansi-bold">   1009</span>     idxs <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>argsort<span class="ansi-blue-fg">(</span>lengths<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span>

<span class="ansi-red-fg">ValueError</span>: Not enough samples to build a trace.
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Estimating frequencies.html" class="btn btn-neutral float-right" title="Choosing the correct frequencies" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../user/citation.html" class="btn btn-neutral float-left" title="Citing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Daniel Hey

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>