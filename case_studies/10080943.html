

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>KIC 10080943 &mdash; maelstrom 0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Maelstrom" href="../api/maelstrom.html" />
    <link rel="prev" title="KIC 6780873" href="6780873.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> maelstrom
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/citation.html">Citing</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/Getting started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/Estimating frequencies.html">Choosing the correct frequencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/Custom priors.html">Custom priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/Recovering weak signals.html">Recovering weak signals</a></li>
</ul>
<p class="caption"><span class="caption-text">Case studies from paper</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="9651065.html">KIC 9651065</a></li>
<li class="toctree-l1"><a class="reference internal" href="6780873.html">KIC 6780873</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">KIC 10080943</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Subdividing">Subdividing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#RV-only">RV only</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Maelstrom">Maelstrom</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Maelstrom-+-RV">Maelstrom + RV</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/maelstrom.html">Maelstrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/orbit.html">Orbit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/periodogram.html">Periodogram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/estimator.html">Estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/eddy.html">Eddy</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">maelstrom</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>KIC 10080943</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/case_studies/10080943.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="KIC-10080943">
<h1>KIC 10080943<a class="headerlink" href="#KIC-10080943" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">run</span> setup.py
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;../data/10080943_lc.txt&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x1c2316def0&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_3_1.png" src="../_images/case_studies_10080943_3_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>
<span class="kn">from</span> <span class="nn">maelstrom.utils</span> <span class="kn">import</span> <span class="n">amplitude_spectrum</span>
<span class="n">y_low</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mf">1.8</span><span class="p">)</span>
<span class="n">y_high</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_low</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">amplitude_spectrum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">amplitude_spectrum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_high</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: AstropyDeprecationWarning: Importing LombScargle from astropy.stats has been deprecated and will no longer be supported in future. Please import this class from the astropy.timeseries module instead [astropy.stats.lombscargle]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x1c238d4e48&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_4_2.png" src="../_images/case_studies_10080943_4_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ms</span> <span class="o">=</span> <span class="n">Maelstrom</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_high</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">13.94758557</span><span class="p">,</span> <span class="mf">15.68333011</span><span class="p">,</span>
                                    <span class="mf">12.45257641</span><span class="p">,</span>
<span class="c1">#                                     12.89053954,</span>
                                    <span class="mf">17.30504092</span><span class="p">,</span>
<span class="c1">#                                     14.20333404</span>
                                   <span class="p">]))</span>
<span class="n">ms</span><span class="o">.</span><span class="n">first_look</span><span class="p">(</span><span class="n">segment_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x11a6adb70&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c238f7cf8&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c23a5c2e8&gt;,
       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1c23a8e898&gt;],
      dtype=object)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_5_1.png" src="../_images/case_studies_10080943_5_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">freq</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">freq</span>
<span class="n">time</span><span class="p">,</span> <span class="n">flux</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">period_guess</span> <span class="o">=</span> <span class="mf">15.334</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_phase</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">nu</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">t</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="mi">1</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DT</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">T</span>
    <span class="n">DTD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">DTD</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">w</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">nu</span><span class="p">)],</span> <span class="n">w</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">nu</span><span class="p">):</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">nu</span><span class="p">)])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">tqdm</span>
<span class="n">t0s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">t0s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
<span class="n">phases</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t0</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">t0s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">t0s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">t0s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">phases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_phase</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">time</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>

<span class="c1"># phases -= np.nanmean(phases, axis=0)</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 420/420 [00:00&lt;00:00, 3232.91it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">phases</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">estimators</span><span class="o">.</span><span class="n">lomb_scargle_estimator</span><span class="p">(</span><span class="n">t0s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">m</span><span class="p">],</span> <span class="n">phases</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">min_period</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;periodogram&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;peaks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;power&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_10_1.png" src="../_images/case_studies_10080943_10_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">period_guess</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;peaks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;period&quot;</span><span class="p">]</span>
<span class="n">arg</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t0s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">/</span><span class="n">period_guess</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">],</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">],</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phases</span><span class="p">[</span><span class="n">m</span><span class="p">]),</span> <span class="mi">1</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">D</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">phases</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
<span class="n">a_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mi">86400</span>
<span class="n">period_guess</span><span class="p">,</span> <span class="n">a_guess</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(15.335878873082686, 43.18400031048696)
</pre></div></div>
</div>
<div class="section" id="Subdividing">
<h2>Subdividing<a class="headerlink" href="#Subdividing" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">dft_phase</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freq</span><span class="p">:</span>
        <span class="n">expo</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">x</span>
        <span class="n">ft_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">expo</span><span class="p">))</span>
        <span class="n">ft_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">expo</span><span class="p">))</span>
        <span class="n">phase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">ft_imag</span><span class="p">,</span><span class="n">ft_real</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">phase</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">LombScargle</span>

<span class="n">freq</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">segment_size</span><span class="o">=</span><span class="mi">4</span>

<span class="n">uHz_conv</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
<span class="n">time_0</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">time_slice</span><span class="p">,</span> <span class="n">mag_slice</span><span class="p">,</span> <span class="n">phase</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">time_delays</span><span class="p">,</span> <span class="n">time_midpoints</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="c1"># Iterate over lightcurve</span>
<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">):</span>
    <span class="n">time_slice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">mag_slice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># In each segment</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">time_0</span> <span class="o">&gt;</span> <span class="n">segment_size</span><span class="p">:</span>
        <span class="c1"># Append the time midpoint</span>
        <span class="n">time_midpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">time_slice</span><span class="p">))</span>

        <span class="c1"># And the phases for each frequency</span>
        <span class="n">phase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dft_phase</span><span class="p">(</span><span class="n">time_slice</span><span class="p">,</span> <span class="n">mag_slice</span><span class="p">,</span> <span class="n">freq</span><span class="p">))</span>
        <span class="n">time_0</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">time_slice</span><span class="p">,</span> <span class="n">mag_slice</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># Phase wrapping patch</span>
<span class="k">for</span> <span class="n">ph</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
    <span class="n">mean_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
    <span class="n">ph</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ph</span> <span class="o">-</span> <span class="n">mean_phase</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ph</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ph</span> <span class="o">-</span> <span class="n">mean_phase</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ph</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
<span class="c1">#     ph = np.unwrap(ph)</span>
<span class="c1">#     ph -= np.mean(ph)</span>

    <span class="n">td</span> <span class="o">=</span> <span class="n">ph</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="n">uHz_conv</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">))</span>
    <span class="n">time_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">td</span><span class="p">)</span>

<span class="n">weights</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1">#|plt.scatter(time_midpoints,np.average(time_delays,axis=0, weights=weights))</span>

<span class="n">td_time</span><span class="p">,</span> <span class="n">td_td</span> <span class="o">=</span> <span class="n">time_midpoints</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#nu_arr = freq</span>
<span class="n">td_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">td_time</span><span class="p">)</span>
<span class="n">td_td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">td_td</span><span class="p">)</span>
<span class="c1"># td_time, td_td = np.array(time_midpoints), np.array(time_delays[0])</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">weights</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1.34772162, 1.24429097, 0.91763563, 0.61523976])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">subdivide_model</span><span class="p">:</span>
    <span class="n">logP</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;logP&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">period_guess</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">period_guess</span><span class="p">))</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logP</span><span class="p">))</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">td_td</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">td_td</span><span class="p">))</span>
    <span class="c1"># The time of conjunction</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">)</span>
    <span class="n">logs_lc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logs_lc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">flux</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">logasini</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logasini&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a_guess</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a_guess</span><span class="p">))</span>
    <span class="n">asini</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;asini&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logasini</span><span class="p">))</span>
    <span class="c1">#drift = pm.Normal(&#39;drift&#39;, mu=0., sd=0.1, testval=0)</span>
    <span class="c1"># Periastron sampled from uniform angle</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="c1"># Eccentricity</span>
    <span class="n">eccen</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;eccen&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="c1"># Mean anom</span>
    <span class="n">M</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">td_time</span> <span class="o">/</span> <span class="n">period</span> <span class="o">-</span> <span class="n">phi</span>

    <span class="c1"># True anom</span>
    <span class="n">kepler_op</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">theano_ops</span><span class="o">.</span><span class="n">kepler</span><span class="o">.</span><span class="n">KeplerOp</span><span class="p">()</span>
    <span class="n">sinf</span><span class="p">,</span> <span class="n">cosf</span> <span class="o">=</span> <span class="n">kepler_op</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">eccen</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td_time</span><span class="p">)))</span>

    <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">eccen</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">/=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">eccen</span> <span class="o">*</span> <span class="n">cosf</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">sinf</span><span class="o">*</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span><span class="o">+</span><span class="n">cosf</span><span class="o">*</span><span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">asini</span> <span class="o">*</span> <span class="n">psi</span>
    <span class="c1">#tau += td_time * drift</span>
    <span class="n">taumodel</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;taumodel&#39;</span><span class="p">,</span> <span class="n">tau</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">+</span> <span class="n">mean</span><span class="p">)</span>

    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">taumodel</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logs_lc</span><span class="p">),</span> <span class="n">observed</span><span class="o">=</span><span class="n">td_td</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">td_time</span><span class="p">,</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">taumodel</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">td_time</span><span class="p">,</span> <span class="n">td_td</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_16_0.png" src="../_images/case_studies_10080943_16_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">subdivide_model</span><span class="p">:</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">mean</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logP</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logasini</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">omega</span><span class="p">,</span> <span class="n">eccen</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
optimizing logp for variables: [mean]
5it [00:01,  2.80it/s, logp=-1.276811e+06]
message: Optimization terminated successfully.
logp: -1277151.0054081937 -&gt; -1276810.5971639934
optimizing logp for variables: [logP]
13it [00:00, 88.30it/s, logp=-9.719662e+05]
message: Optimization terminated successfully.
logp: -1276810.5971639934 -&gt; -971966.1627903979
optimizing logp for variables: [logasini]
16it [00:00, 83.34it/s, logp=-8.544680e+05]
message: Optimization terminated successfully.
logp: -971966.1627903979 -&gt; -854468.0445354239
optimizing logp for variables: [eccen, omega]
137it [00:00, 282.98it/s, logp=-8.541406e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -854468.0445354239 -&gt; -854140.5739847843
optimizing logp for variables: [eccen, omega, logasini, logs_lc, phi, mean, logP]
21it [00:00, 116.03it/s, logp=-1.021591e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -854140.5739847843 -&gt; -114780.21445976157
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">subdivide_model</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [eccen, omega, logasini, logs_lc, phi, mean, logP]
Sampling 2 chains: 100%|██████████| 8000/8000 [12:15&lt;00:00, 10.88draws/s]
The acceptance probability does not match the target. It is 0.9187384576573221, but should be close to 0.8. Try to increase the number of tuning steps.
There were 130 divergences after tuning. Increase `target_accept` or reparameterize.
The acceptance probability does not match the target. It is 0.16236133349742451, but should be close to 0.8. Try to increase the number of tuning steps.
The chain reached the maximum tree depth. Increase max_treedepth, increase target_accept or reparameterize.
The gelman-rubin statistic is larger than 1.4 for some parameters. The sampler did not converge.
The estimated number of effective samples is smaller than 200 for some parameters.
</pre></div></div>
</div>
</div>
<div class="section" id="RV-only">
<h2>RV only<a class="headerlink" href="#RV-only" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rv_jd_a</span><span class="p">,</span> <span class="n">rv_rv_a</span><span class="p">,</span> <span class="n">rv_err_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;../../data/kic10080943a_JDrv.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">rv_jd_a</span> <span class="o">+=</span> <span class="mi">2400000</span>
<span class="n">rv_jd_a</span> <span class="o">-=</span> <span class="mi">2454833</span>

<span class="n">rv_jd_b</span><span class="p">,</span> <span class="n">rv_rv_b</span><span class="p">,</span> <span class="n">rv_err_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;../../data/kic10080943b_JDrv.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">rv_jd_b</span> <span class="o">+=</span> <span class="mi">2400000</span>
<span class="n">rv_jd_b</span> <span class="o">-=</span> <span class="mi">2454833</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="n">period_guess</span> <span class="o">/</span> <span class="n">period_guess</span><span class="p">,</span> <span class="n">rv_rv_a</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_b</span> <span class="o">%</span> <span class="n">period_guess</span> <span class="o">/</span> <span class="n">period_guess</span><span class="p">,</span> <span class="n">rv_rv_b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x1c275efe10&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_20_1.png" src="../_images/case_studies_10080943_20_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">exoplanet.orbits</span> <span class="kn">import</span> <span class="n">get_true_anomaly</span>
<span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>
<span class="kn">from</span> <span class="nn">maelstrom.orbit</span> <span class="kn">import</span> <span class="n">Orbit</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">20</span><span class="p">)(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">period_guess</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">shape</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">period_guess</span><span class="p">)</span>

    <span class="n">asini</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;asini&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a_guess</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">a_guess</span><span class="p">]),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a_guess</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">a_guess</span><span class="p">]),</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">logs_a</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;logs_a&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rv_err_a</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">logs_b</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;logs_b&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rv_err_b</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>

    <span class="n">ecc</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">UnitUniform</span><span class="p">(</span><span class="s2">&quot;ecc&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gammav</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s1">&#39;gammav&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

    <span class="n">orbit_a</span> <span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">P</span><span class="p">,</span>
                   <span class="n">lighttime</span><span class="o">=</span><span class="n">asini</span><span class="p">,</span>
                   <span class="n">phi</span><span class="o">=</span><span class="n">phi</span><span class="p">,</span>
                   <span class="n">eccen</span><span class="o">=</span><span class="n">ecc</span><span class="p">,</span>
                   <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">)</span>
    <span class="n">vrad_a</span> <span class="o">=</span> <span class="n">orbit_a</span><span class="o">.</span><span class="n">get_radial_velocity</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">gammav</span>
    <span class="n">err_a</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">rv_err_a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">logs_a</span><span class="p">))</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">vrad_a</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">err_a</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">rv_rv_a</span><span class="p">)</span>

    <span class="n">vrad_b</span> <span class="o">=</span> <span class="n">orbit_a</span><span class="o">.</span><span class="n">get_radial_velocity</span><span class="p">(</span><span class="n">rv_jd_b</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">gammav</span>
    <span class="n">err_b</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">rv_err_b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">logs_b</span><span class="p">))</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;obs_b&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">vrad_b</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">err_b</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">rv_rv_b</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">rv_jd_a</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">fine_grid_a</span> <span class="o">=</span> <span class="n">orbit_a</span><span class="o">.</span><span class="n">get_radial_velocity</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">gammav</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">test_point</span><span class="p">)</span>
    <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_soln</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">gammav</span><span class="p">])</span>
    <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_soln</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">phi</span><span class="p">])</span>
    <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_soln</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
optimizing logp for variables: [phi, gammav, omega, ecc, logs_b, logs_a, asini, P]
322it [00:01, 205.07it/s, logp=-2.168263e+01]
message: Desired error not necessarily achieved due to precision loss.
logp: -681450.5463788682 -&gt; -21.68262962535469
optimizing logp for variables: [gammav]
5it [00:00, 63.38it/s, logp=-2.168263e+01]
message: Optimization terminated successfully.
logp: -21.68262962535469 -&gt; -21.682629625354622
optimizing logp for variables: [phi]
3it [00:00, 42.23it/s, logp=-2.168263e+01]
message: Optimization terminated successfully.
logp: -21.682629625354622 -&gt; -21.682629625354622
optimizing logp for variables: [phi, gammav, omega, ecc, logs_b, logs_a, asini, P]
96it [00:00, 360.59it/s, logp=-2.212767e+01]
message: Desired error not necessarily achieved due to precision loss.
logp: -21.682629625354622 -&gt; -21.682629625354622
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">map_soln</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;P_interval__&#39;: array([1.19038812]),
 &#39;asini&#39;: array([ 44.9292204, -43.198366 ]),
 &#39;logs_a&#39;: array(-0.16539749),
 &#39;logs_b&#39;: array(-1.05667061),
 &#39;ecc_logodds__&#39;: array([-0.18874464]),
 &#39;omega_angle__&#39;: array([[-1.17601462],
        [ 4.31474094]]),
 &#39;gammav_interval__&#39;: array(-0.99170963),
 &#39;phi_angle__&#39;: array([-2.7313461 ,  3.54115056]),
 &#39;P&#39;: array([15.33620944]),
 &#39;ecc&#39;: array([0.45295343]),
 &#39;omega&#39;: array([-0.26609394]),
 &#39;gammav&#39;: array(-22.94254738),
 &#39;phi&#39;: array(-0.65700436)}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">fold</span> <span class="o">=</span> <span class="n">t</span> <span class="o">%</span> <span class="n">map_soln</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_soln</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fold</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">fine_grid_a</span><span class="p">,</span> <span class="n">map_soln</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">sort</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="n">map_soln</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_soln</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">rv_rv_a</span><span class="p">,</span><span class="s1">&#39;.k&#39;</span><span class="p">)</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">fine_grid_a</span><span class="p">,</span> <span class="n">map_soln</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">sort</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rv_jd_b</span> <span class="o">%</span> <span class="n">map_soln</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_soln</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">rv_rv_b</span><span class="p">,</span><span class="s1">&#39;.k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_24_0.png" src="../_images/case_studies_10080943_24_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">tune</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">xo</span><span class="o">.</span><span class="n">get_dense_nuts_step</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.95</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="n">map_soln</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [phi, gammav, omega, ecc, logs_b, logs_a, asini, P]
Sampling 2 chains: 100%|██████████| 8000/8000 [00:35&lt;00:00, 225.12draws/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/danielhey/anaconda3/lib/python3.7/site-packages/pymc3/stats.py:991: FutureWarning: The join_axes-keyword is deprecated. Use .reindex or .reindex_like on the result to achieve the same functionality.
  axis=1, join_axes=[dforg.index])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>mc_error</th>
      <th>hpd_2.5</th>
      <th>hpd_97.5</th>
      <th>n_eff</th>
      <th>Rhat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>asini__0</th>
      <td>44.924885</td>
      <td>0.173424</td>
      <td>0.002319</td>
      <td>44.579209</td>
      <td>45.259325</td>
      <td>5496.583279</td>
      <td>0.999759</td>
    </tr>
    <tr>
      <th>asini__1</th>
      <td>-43.194197</td>
      <td>0.091308</td>
      <td>0.001336</td>
      <td>-43.368314</td>
      <td>-43.009628</td>
      <td>5345.994877</td>
      <td>0.999759</td>
    </tr>
    <tr>
      <th>logs_a</th>
      <td>-0.091387</td>
      <td>0.165575</td>
      <td>0.002104</td>
      <td>-0.416011</td>
      <td>0.220438</td>
      <td>4851.183366</td>
      <td>0.999881</td>
    </tr>
    <tr>
      <th>logs_b</th>
      <td>-0.852652</td>
      <td>0.230484</td>
      <td>0.003940</td>
      <td>-1.279749</td>
      <td>-0.383615</td>
      <td>3454.348539</td>
      <td>0.999813</td>
    </tr>
    <tr>
      <th>P__0</th>
      <td>15.336216</td>
      <td>0.000178</td>
      <td>0.000003</td>
      <td>15.335883</td>
      <td>15.336577</td>
      <td>3260.911780</td>
      <td>0.999853</td>
    </tr>
    <tr>
      <th>ecc__0</th>
      <td>0.453039</td>
      <td>0.001636</td>
      <td>0.000024</td>
      <td>0.450002</td>
      <td>0.456456</td>
      <td>5022.503137</td>
      <td>0.999815</td>
    </tr>
    <tr>
      <th>omega__0</th>
      <td>-0.266588</td>
      <td>0.005529</td>
      <td>0.000085</td>
      <td>-0.277859</td>
      <td>-0.256162</td>
      <td>3981.518066</td>
      <td>0.999931</td>
    </tr>
    <tr>
      <th>gammav</th>
      <td>-22.935786</td>
      <td>0.092157</td>
      <td>0.001381</td>
      <td>-23.115612</td>
      <td>-22.754384</td>
      <td>4348.433787</td>
      <td>0.999873</td>
    </tr>
    <tr>
      <th>phi</th>
      <td>-0.657458</td>
      <td>0.010379</td>
      <td>0.000190</td>
      <td>-0.678072</td>
      <td>-0.637912</td>
      <td>3111.050305</td>
      <td>0.999781</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">corner</span>

<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">trace_to_dataframe</span><span class="p">(</span><span class="n">trace</span><span class="p">),</span> <span class="n">smooth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_27_0.png" src="../_images/case_studies_10080943_27_0.png" />
</div>
</div>
</div>
<div class="section" id="Maelstrom">
<h2>Maelstrom<a class="headerlink" href="#Maelstrom" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;../data/10080943_lc.txt&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">ms</span> <span class="o">=</span> <span class="n">Maelstrom</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">13.94758557</span><span class="p">,</span> <span class="mf">15.68333011</span><span class="p">,</span>
                                    <span class="mf">12.45257641</span><span class="p">,</span>
                                    <span class="mf">12.89053954</span><span class="p">,</span>
                                    <span class="mf">17.30504092</span><span class="p">,</span>
                                    <span class="mf">14.20333404</span>
                                   <span class="p">]))</span>

<span class="n">ms</span><span class="o">.</span><span class="n">setup_orbit_model</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period_guess</span><span class="p">,</span> <span class="n">eccen</span><span class="o">=</span><span class="mf">0.47</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">opt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;logperiod&#39;: array(2.73070653),
 &#39;t0&#39;: array(0.1754545),
 &#39;varpi_angle__&#39;: array([0.70727021, 4.41585427]),
 &#39;eccen_interval__&#39;: array(-0.02445806),
 &#39;logs&#39;: array(1.50528192),
 &#39;lighttime&#39;: array([ 53.61766022, -38.84906062, -33.42202446, -51.58519959,
        -27.89396805,  26.80916947]),
 &#39;mean_flux&#39;: array(-1.82077127e-05),
 &#39;W_hat_cos&#39;: array([ 1.05634432, -0.39108877,  0.13741391,  0.74102315,  0.31710875,
         0.12761664]),
 &#39;W_hat_sin&#39;: array([ 0.85777381, -1.18869863,  0.92644697,  0.11229363, -0.53772146,
         0.30426538]),
 &#39;period&#39;: array(15.34372403),
 &#39;varpi&#39;: array(0.15881722),
 &#39;eccen&#39;: array(0.49388591),
 &#39;tref&#39;: array(-1.11385146)}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lt</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;lighttime&#39;</span><span class="p">]</span>

<span class="n">lt_ivar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">lt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">)</span>
<span class="n">mask_lower</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">mask_upper</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">&gt;</span> <span class="mf">1.0</span>

<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_lower</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_upper</span><span class="p">):</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">lt</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="o">~</span><span class="n">m1</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m1</span><span class="p">]</span><span class="o">*</span><span class="n">lt</span><span class="p">[</span><span class="n">m1</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m1</span><span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m2</span><span class="p">]</span><span class="o">*</span><span class="n">lt</span><span class="p">[</span><span class="n">m2</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m2</span><span class="p">]),</span>
    <span class="p">])</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">m1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lt</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="o">*</span><span class="n">lt</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">)])</span>
<span class="n">pinned_lt</span> <span class="o">=</span> <span class="n">lt</span>


<span class="n">nu_arr_negative</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inds</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">nu_arr_positive</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inds</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pinned_lt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 26.80916947, -37.20245805])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nu_arr_negative</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([15.68333011, 12.45257641, 12.89053954, 17.30504092])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pinned_lt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">exoplanet.orbits</span> <span class="kn">import</span> <span class="n">get_true_anomaly</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>
<span class="kn">from</span> <span class="nn">maelstrom.orbit</span> <span class="kn">import</span> <span class="n">Orbit</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">logP</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span>
                    <span class="n">lower</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                    <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">50</span><span class="p">))(</span><span class="s2">&quot;logP&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                      <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]))</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logP</span><span class="p">))</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">)</span>
    <span class="n">logs_lc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logs_lc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.0001</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">flux</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="c1">#     a1sini = pm.Normal(&quot;a1sini&quot;, mu=pinned_lt[0], sd=15, testval=pinned_lt[0])</span>
<span class="c1">#     a2sini = pm.Normal(&quot;a2sini&quot;, mu=pinned_lt[1], sd=15, testval=pinned_lt[1])</span>

    <span class="n">asini</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;a1sini&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">))</span>

    <span class="n">nu</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;nu1&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">))</span>
    <span class="c1"># The baseline flux</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.00</span><span class="p">)</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;varpi&#39;</span><span class="p">])</span>
    <span class="n">eccen</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;eccen&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;eccen&#39;</span><span class="p">])</span>

    <span class="n">orbit</span> <span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
                  <span class="n">lighttime</span><span class="o">=</span><span class="n">asini</span><span class="p">,</span>
                  <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
                  <span class="n">eccen</span><span class="o">=</span><span class="n">eccen</span><span class="p">,</span>
                  <span class="n">phi</span><span class="o">=</span><span class="n">phi</span><span class="p">,</span>
                  <span class="n">freq</span><span class="o">=</span><span class="n">nu</span><span class="p">,)</span>

    <span class="n">full_lc</span> <span class="o">=</span> <span class="n">orbit</span><span class="o">.</span><span class="n">get_lightcurve_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">)</span> <span class="o">+</span> <span class="n">mean</span>
<span class="c1">#     # GP parameters</span>
    <span class="n">logw0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;logw0&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">logpower</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;logpower&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">flux</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">logS0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;logS0&quot;</span><span class="p">,</span> <span class="n">logpower</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">logw0</span><span class="p">)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">gp</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">SHOTerm</span><span class="p">(</span><span class="n">log_S0</span><span class="o">=</span><span class="n">logS0</span><span class="p">,</span> <span class="n">log_w0</span><span class="o">=</span><span class="n">logw0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">gp</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">gp</span><span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">logs_lc</span><span class="p">)</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span> <span class="n">J</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">pm</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">flux</span> <span class="o">-</span> <span class="n">full_lc</span><span class="p">))</span>
<span class="c1">#     pm.Normal(&#39;obs&#39;, mu=full_lc, sd=tt.exp(logs_lc), observed=flux)</span>


<span class="c1"># from maelstrom.utils import amplitude_spectrum</span>
<span class="c1"># with model:</span>
<span class="c1">#     full_lc = xo.eval_in_model(orbit1.get_lightcurve_model(time, flux) + orbit2.get_lightcurve_model(time, flux) + mean)</span>
<span class="c1">#     plt.plot(*amplitude_spectrum(time, full_lc))</span>
<span class="c1">#     plt.plot(*amplitude_spectrum(time, xo.eval_in_model(gp.predict())))</span>

<span class="c1">#     plt.plot(*amplitude_spectrum(time, flux), alpha=0.2)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">orbit</span><span class="o">.</span><span class="n">get_time_delay</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">map_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">all_but</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">vars</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;logP_interval__&quot;</span><span class="p">,</span> <span class="s2">&quot;logasini_interval__&quot;</span><span class="p">]]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">mean</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logs_lc</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logpower</span><span class="p">,</span> <span class="n">logw0</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">omega</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">phi</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">nu</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">asini</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logP</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">asini</span><span class="p">])</span>
<span class="c1">#     map_params = xo.optimize(start=map_params)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[phi_angle__, logs_lc, a1sini_interval__, nu1, mean, omega_angle__, eccen_interval__, logw0, logpower]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
optimizing logp for variables: [mean]
5it [00:00, 15.82it/s, logp=-9.163383e+04]
message: Optimization terminated successfully.
logp: -91633.828619446 -&gt; -91633.82860917287
optimizing logp for variables: [logs_lc]
9it [00:00, 17.46it/s, logp=-9.141334e+04]
message: Optimization terminated successfully.
logp: -91633.82860917287 -&gt; -91413.34466631243
optimizing logp for variables: [logw0, logpower]
157it [00:08, 18.02it/s, logp=nan]
message: Desired error not necessarily achieved due to precision loss.
logp: -91413.34466631243 -&gt; nan
final logp not finite, returning initial point
this suggests that something is wrong with the model
optimizing logp for variables: [omega]
10it [00:00, 14.55it/s, logp=-9.139289e+04]
message: Optimization terminated successfully.
logp: -91413.34466631243 -&gt; -91392.88734357689
optimizing logp for variables: [phi]
10it [00:00, 12.93it/s, logp=-9.137243e+04]
message: Optimization terminated successfully.
logp: -91392.88734357689 -&gt; -91372.43002084136
optimizing logp for variables: [nu1]
69it [00:04, 16.53it/s, logp=-9.137222e+04]
message: Desired error not necessarily achieved due to precision loss.
logp: -91372.43002084136 -&gt; -91372.2151340031
optimizing logp for variables: [logpower, logw0, eccen, omega, mean, nu1, a1sini, logs_lc, phi]
201it [00:15, 12.84it/s, logp=-8.778066e+04]
message: Desired error not necessarily achieved due to precision loss.
logp: -91372.2151340031 -&gt; -87780.66225683772
optimizing logp for variables: [a1sini]
7it [00:00, 14.50it/s, logp=-8.778066e+04]
message: Optimization terminated successfully.
logp: -87780.66225683772 -&gt; -87780.6622568302
optimizing logp for variables: [logpower, logw0, eccen, omega, mean, nu1, a1sini, logs_lc, phi]
91it [00:07, 12.71it/s, logp=-8.778066e+04]
message: Desired error not necessarily achieved due to precision loss.
logp: -87780.6622568302 -&gt; -87780.66225682988
optimizing logp for variables: [logP]
11it [00:00, 13.02it/s, logp=-8.778014e+04]
message: Optimization terminated successfully.
logp: -87780.66225682988 -&gt; -87780.13935379263
optimizing logp for variables: [logpower, logw0, eccen, omega, mean, nu1, a1sini, logs_lc, phi]
366it [00:27, 13.10it/s, logp=-8.676328e+04]
message: Desired error not necessarily achieved due to precision loss.
logp: -87780.13935379263 -&gt; -86763.278841923
optimizing logp for variables: [a1sini]
3it [00:00, 11.70it/s, logp=-8.676328e+04]
message: Optimization terminated successfully.
logp: -86763.278841923 -&gt; -86763.278841923
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">map_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;logP_interval__&#39;: array(-0.05248899),
 &#39;phi_angle__&#39;: array([-2.47541001,  3.72455975]),
 &#39;logs_lc&#39;: array(-5.34164897),
 &#39;a1sini_interval__&#39;: array([ 2.54312226, -1.84415116, -1.65807324, -2.69856194, -1.29883947,
         1.53443407]),
 &#39;nu1&#39;: array([13.94758547, 15.68333016, 12.45257689, 12.89054031, 17.30504162,
        14.20333566]),
 &#39;mean&#39;: array(5.3961631e-05),
 &#39;omega_angle__&#39;: array([-0.1865062 ,  4.46824522]),
 &#39;eccen_interval__&#39;: array(0.14231698),
 &#39;logw0&#39;: array(4.76142513),
 &#39;logpower&#39;: array(14.48418565),
 &#39;logP&#39;: array(2.7305223),
 &#39;period&#39;: array(15.34089752),
 &#39;phi&#39;: array(-0.58658306),
 &#39;a1sini&#39;: array([ 51.25321208, -43.61267018, -40.79750263, -52.43300811,
        -34.2767524 ,  38.71849745]),
 &#39;omega&#39;: array(-0.04171615),
 &#39;eccen&#39;: array(0.5349838),
 &#39;logS0&#39;: array(-4.56151486)}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;a1sini&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">val</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.00029825, 0.00029238, 0.00028638, ..., 0.0004718 , 0.00047275,
        0.00047367],
       [0.00022531, 0.00022087, 0.00021634, ..., 0.00035642, 0.00035713,
        0.00035782]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">3.3333</span><span class="p">,</span><span class="mf">2.06</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">orbit</span><span class="o">.</span><span class="n">get_time_delay</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">map_params</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="mi">86400</span>
    <span class="n">tt_time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">tt_time</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">maelstrom.utils</span> <span class="kn">import</span> <span class="n">unique_colors</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pos_td</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;a1sini&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">unique_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_td</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Oranges&#39;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">neg_td</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;a1sini&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">neg</span> <span class="o">=</span> <span class="n">unique_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neg_td</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">td</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_td</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">td</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

<span class="k">for</span> <span class="n">td</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">neg_td</span><span class="p">,</span> <span class="n">neg</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">td</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Orbital phase&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Time delay (s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">maelstrom.utils</span> <span class="kn">import</span> <span class="n">amplitude_spectrum</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">amplitude_spectrum</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (d$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (ppt)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pos_freq</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;a1sini&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">pos_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;a1sini&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">neg_freq</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;a1sini&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">neg_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;a1sini&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ff</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_freq</span><span class="p">,</span> <span class="n">pos_weight</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="n">weight</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ff</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">neg_freq</span><span class="p">,</span> <span class="n">neg_weight</span><span class="p">,</span> <span class="n">neg</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="n">weight</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">overleaf_path</span><span class="o">+</span><span class="s1">&#39;10080943_init_opt.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_41_0.png" src="../_images/case_studies_10080943_41_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">exoplanet.orbits</span> <span class="kn">import</span> <span class="n">get_true_anomaly</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">logP</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span>
                    <span class="n">lower</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                    <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">50</span><span class="p">))(</span><span class="s2">&quot;logP&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                      <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]))</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logP</span><span class="p">))</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">)</span>
    <span class="n">logs_lc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logs_lc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.0001</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">flux</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="c1">#     a1sini = pm.Normal(&quot;a1sini&quot;, mu=pinned_lt[0], sd=15, testval=pinned_lt[0])</span>
<span class="c1">#     a2sini = pm.Normal(&quot;a2sini&quot;, mu=pinned_lt[1], sd=15, testval=pinned_lt[1])</span>

    <span class="n">a1sini</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;a1sini&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">a2sini</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;a2sini&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">nu1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;nu1&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">nu_arr_positive</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">nu_arr_positive</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nu_arr_positive</span><span class="p">))</span>
    <span class="n">nu2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;nu2&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">nu_arr_negative</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">nu_arr_negative</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nu_arr_negative</span><span class="p">))</span>
    <span class="c1"># The baseline flux</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.00</span><span class="p">)</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;varpi&#39;</span><span class="p">])</span>
    <span class="n">eccen</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;eccen&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;eccen&#39;</span><span class="p">])</span>

    <span class="n">orbit1</span> <span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
                  <span class="n">lighttime</span><span class="o">=</span><span class="n">a1sini</span><span class="p">,</span>
                  <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
                  <span class="n">eccen</span><span class="o">=</span><span class="n">eccen</span><span class="p">,</span>
                  <span class="n">phi</span><span class="o">=</span><span class="n">phi</span><span class="p">,</span>
                  <span class="n">freq</span><span class="o">=</span><span class="n">nu1</span><span class="p">,</span>
                 <span class="n">with_rv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">gammav</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

    <span class="n">orbit2</span> <span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
              <span class="n">lighttime</span><span class="o">=</span><span class="n">a2sini</span><span class="p">,</span>
              <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
              <span class="n">eccen</span><span class="o">=</span><span class="n">eccen</span><span class="p">,</span>
              <span class="n">phi</span><span class="o">=</span><span class="n">phi</span><span class="p">,</span>
              <span class="n">freq</span><span class="o">=</span><span class="n">nu2</span><span class="p">,</span>
             <span class="n">with_rv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">gammav</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">full_lc</span> <span class="o">=</span> <span class="n">orbit1</span><span class="o">.</span><span class="n">get_lightcurve_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">)</span> <span class="o">+</span> <span class="n">orbit2</span><span class="o">.</span><span class="n">get_lightcurve_model</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">)</span> <span class="o">+</span> <span class="n">mean</span>
<span class="c1">#     # GP parameters</span>
    <span class="n">logw0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;logw0&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">logpower</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;logpower&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">flux</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">logS0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;logS0&quot;</span><span class="p">,</span> <span class="n">logpower</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">logw0</span><span class="p">)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">gp</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">SHOTerm</span><span class="p">(</span><span class="n">log_S0</span><span class="o">=</span><span class="n">logS0</span><span class="p">,</span> <span class="n">log_w0</span><span class="o">=</span><span class="n">logw0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">gp</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">gp</span><span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">logs_lc</span><span class="p">)</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)),</span> <span class="n">J</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">pm</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">flux</span> <span class="o">-</span> <span class="n">full_lc</span><span class="p">))</span>
<span class="c1">#     pm.Normal(&#39;obs&#39;, mu=full_lc, sd=tt.exp(logs_lc), observed=flux)</span>


<span class="c1"># from maelstrom.utils import amplitude_spectrum`</span>
<span class="c1"># with model:</span>
<span class="c1">#     full_lc = xo.eval_in_model(orbit1.get_lightcurve_model(time, flux) + orbit2.get_lightcurve_model(time, flux) + mean)</span>
<span class="c1">#     plt.plot(*amplitude_spectrum(time, full_lc))</span>
<span class="c1">#     plt.plot(*amplitude_spectrum(time, xo.eval_in_model(gp.predict())))</span>

<span class="c1">#     plt.plot(*amplitude_spectrum(time, flux), alpha=0.2)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">all_but</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">vars</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;logP_interval__&quot;</span><span class="p">,</span> <span class="s2">&quot;logasini_interval__&quot;</span><span class="p">]]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">mean</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logs_lc</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logpower</span><span class="p">,</span> <span class="n">logw0</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">omega</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">phi</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">nu1</span><span class="p">,</span> <span class="n">nu2</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">a1sini</span><span class="p">,</span> <span class="n">a2sini</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logP</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">a1sini</span><span class="p">,</span> <span class="n">a2sini</span><span class="p">])</span>
<span class="c1">#     map_params = xo.optimize(start=map_params)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[phi_angle__, logs_lc, a1sini_interval__, a2sini_interval__, nu1, nu2, mean, omega_angle__, eccen_interval__, logw0, logpower]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
optimizing logp for variables: [mean]
5it [00:00, 14.44it/s, logp=-3.755878e+05]
message: Optimization terminated successfully.
logp: -375587.7932657327 -&gt; -375587.77287921746
optimizing logp for variables: [logs_lc]
10it [00:00, 16.14it/s, logp=-1.897250e+05]
message: Optimization terminated successfully.
logp: -375587.77287921746 -&gt; -189724.96580000242
optimizing logp for variables: [logw0, logpower]
16it [00:01, 15.87it/s, logp=-1.667492e+05]
message: Optimization terminated successfully.
logp: -189724.96580000242 -&gt; -166749.20077684356
optimizing logp for variables: [omega]
89it [00:06, 14.78it/s, logp=-1.667282e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -166749.20077684356 -&gt; -166728.17278381056
optimizing logp for variables: [phi]
13it [00:00, 13.32it/s, logp=-1.667077e+05]
message: Optimization terminated successfully.
logp: -166728.17278381056 -&gt; -166707.70834156446
optimizing logp for variables: [nu2, nu1]
63it [00:04, 14.38it/s, logp=-1.667077e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -166707.70834156446 -&gt; -166707.6972500979
optimizing logp for variables: [logpower, logw0, eccen, omega, mean, nu2, nu1, a2sini, a1sini, logs_lc, phi]
142it [00:12,  8.40it/s, logp=-1.249259e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -166707.6972500979 -&gt; -124925.86999531489
optimizing logp for variables: [a2sini, a1sini]
7it [00:00, 11.72it/s, logp=-1.249259e+05]
message: Optimization terminated successfully.
logp: -124925.86999531489 -&gt; -124925.86999530705
optimizing logp for variables: [logpower, logw0, eccen, omega, mean, nu2, nu1, a2sini, a1sini, logs_lc, phi]
70it [00:06, 10.69it/s, logp=-1.249259e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -124925.86999530705 -&gt; -124925.86999530692
optimizing logp for variables: [logP]
13it [00:01, 11.13it/s, logp=-1.249254e+05]
message: Optimization terminated successfully.
logp: -124925.86999530692 -&gt; -124925.43716167277
optimizing logp for variables: [logpower, logw0, eccen, omega, mean, nu2, nu1, a2sini, a1sini, logs_lc, phi]
126it [00:09, 12.83it/s, logp=-1.249250e+05]
message: Desired error not necessarily achieved due to precision loss.
logp: -124925.43716167277 -&gt; -124925.01292449453
optimizing logp for variables: [a2sini, a1sini]
3it [00:00, 11.57it/s, logp=-1.249250e+05]
message: Optimization terminated successfully.
logp: -124925.01292449453 -&gt; -124925.01292449453
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">map_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;logP_interval__&#39;: array(-0.05248899),
 &#39;phi_angle__&#39;: array([-2.47541001,  3.72455975]),
 &#39;logs_lc&#39;: array(-5.34164897),
 &#39;a1sini_interval__&#39;: array([ 2.54312226, -1.84415116, -1.65807324, -2.69856194, -1.29883947,
         1.53443407]),
 &#39;nu1&#39;: array([13.94758547, 15.68333016, 12.45257689, 12.89054031, 17.30504162,
        14.20333566]),
 &#39;mean&#39;: array(5.3961631e-05),
 &#39;omega_angle__&#39;: array([-0.1865062 ,  4.46824522]),
 &#39;eccen_interval__&#39;: array(0.14231698),
 &#39;logw0&#39;: array(4.76142513),
 &#39;logpower&#39;: array(14.48418565),
 &#39;logP&#39;: array(2.7305223),
 &#39;period&#39;: array(15.34089752),
 &#39;phi&#39;: array(-0.58658306),
 &#39;a1sini&#39;: array([ 51.25321208, -43.61267018, -40.79750263, -52.43300811,
        -34.2767524 ,  38.71849745]),
 &#39;omega&#39;: array(-0.04171615),
 &#39;eccen&#39;: array(0.5349838),
 &#39;logS0&#39;: array(-4.56151486)}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rv_jd_a</span><span class="p">,</span> <span class="n">rv_rv_a</span><span class="p">,</span> <span class="n">rv_err_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;../../data/kic10080943a_JDrv.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">rv_jd_a</span> <span class="o">+=</span> <span class="mi">2400000</span>
<span class="n">rv_jd_a</span> <span class="o">-=</span> <span class="mi">2454833</span>

<span class="n">rv_jd_b</span><span class="p">,</span> <span class="n">rv_rv_b</span><span class="p">,</span> <span class="n">rv_err_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;../../data/kic10080943b_JDrv.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">rv_jd_b</span> <span class="o">+=</span> <span class="mi">2400000</span>
<span class="n">rv_jd_b</span> <span class="o">-=</span> <span class="mi">2454833</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">time</span> <span class="o">%</span> <span class="mf">15.34003849</span> <span class="o">/</span> <span class="mf">15.34003849</span><span class="p">,</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">orbit1</span><span class="o">.</span><span class="n">get_radial_velocity</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">map_params</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">time</span> <span class="o">%</span> <span class="mf">15.34003849</span> <span class="o">/</span> <span class="mf">15.34003849</span><span class="p">,</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">orbit1</span><span class="o">.</span><span class="n">get_time_delay</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">map_params</span><span class="p">)</span><span class="o">*</span><span class="mi">86400</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="mf">15.34003849</span> <span class="o">/</span> <span class="mf">15.34003849</span><span class="p">,</span> <span class="n">rv_rv_a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_46_0.png" src="../_images/case_studies_10080943_46_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">PyMC3Sampler</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">burnin</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">step_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains:  12%|█▏        | 36/308 [02:05&lt;15:48,  3.49s/draws]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_mp_sample</span><span class="ansi-blue-fg">(draws, tune, step, chains, cores, chain, random_seed, start, progressbar, trace, model, use_mmap, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    998</span>             <span class="ansi-green-fg">with</span> sampler<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 999</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">for</span> draw <span class="ansi-green-fg">in</span> sampler<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1000</span>                     trace <span class="ansi-blue-fg">=</span> traces<span class="ansi-blue-fg">[</span>draw<span class="ansi-blue-fg">.</span>chain <span class="ansi-blue-fg">-</span> chain<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/parallel_sampling.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    304</span>         <span class="ansi-green-fg">while</span> self<span class="ansi-blue-fg">.</span>_active<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 305</span><span class="ansi-red-fg">             </span>draw <span class="ansi-blue-fg">=</span> ProcessAdapter<span class="ansi-blue-fg">.</span>recv_draw<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_active<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    306</span>             proc<span class="ansi-blue-fg">,</span> is_last<span class="ansi-blue-fg">,</span> draw<span class="ansi-blue-fg">,</span> tuning<span class="ansi-blue-fg">,</span> stats<span class="ansi-blue-fg">,</span> warns <span class="ansi-blue-fg">=</span> draw

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/parallel_sampling.py</span> in <span class="ansi-cyan-fg">recv_draw</span><span class="ansi-blue-fg">(processes, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    213</span>         pipes <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>proc<span class="ansi-blue-fg">.</span>_msg_pipe <span class="ansi-green-fg">for</span> proc <span class="ansi-green-fg">in</span> processes<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 214</span><span class="ansi-red-fg">         </span>ready <span class="ansi-blue-fg">=</span> multiprocessing<span class="ansi-blue-fg">.</span>connection<span class="ansi-blue-fg">.</span>wait<span class="ansi-blue-fg">(</span>pipes<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    215</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> ready<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/multiprocessing/connection.py</span> in <span class="ansi-cyan-fg">wait</span><span class="ansi-blue-fg">(object_list, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    919</span>             <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 920</span><span class="ansi-red-fg">                 </span>ready <span class="ansi-blue-fg">=</span> selector<span class="ansi-blue-fg">.</span>select<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    921</span>                 <span class="ansi-green-fg">if</span> ready<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/selectors.py</span> in <span class="ansi-cyan-fg">select</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    414</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 415</span><span class="ansi-red-fg">             </span>fd_event_list <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_selector<span class="ansi-blue-fg">.</span>poll<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    416</span>         <span class="ansi-green-fg">except</span> InterruptedError<span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>:

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-64-e75ea9af54ba&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> sampler <span class="ansi-blue-fg">=</span> xo<span class="ansi-blue-fg">.</span>PyMC3Sampler<span class="ansi-blue-fg">(</span>window<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">,</span> finish<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">500</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-fg">with</span> model<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">     </span>burnin <span class="ansi-blue-fg">=</span> sampler<span class="ansi-blue-fg">.</span>tune<span class="ansi-blue-fg">(</span>tune<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">,</span> step_kwargs<span class="ansi-blue-fg">=</span>dict<span class="ansi-blue-fg">(</span>target_accept<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0.9</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> start<span class="ansi-blue-fg">=</span>map_params<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/exoplanet/sampling.py</span> in <span class="ansi-cyan-fg">tune</span><span class="ansi-blue-fg">(self, tune, start, step_kwargs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    205</span>
<span class="ansi-green-intense-fg ansi-bold">    206</span>         self<span class="ansi-blue-fg">.</span>count <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-fg">--&gt; 207</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>warmup<span class="ansi-blue-fg">(</span>start<span class="ansi-blue-fg">=</span>start<span class="ansi-blue-fg">,</span> step_kwargs<span class="ansi-blue-fg">=</span>step_kwargs<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span>         steps <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>window
<span class="ansi-green-intense-fg ansi-bold">    209</span>         trace <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/exoplanet/sampling.py</span> in <span class="ansi-cyan-fg">warmup</span><span class="ansi-blue-fg">(self, start, step_kwargs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    138</span>             step_kwargs <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span>
<span class="ansi-green-intense-fg ansi-bold">    139</span>         step <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>get_step_for_trace<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>step_kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 140</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_extend<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>start<span class="ansi-blue-fg">,</span> start<span class="ansi-blue-fg">=</span>start<span class="ansi-blue-fg">,</span> step<span class="ansi-blue-fg">=</span>step<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    141</span>         <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_current_trace
<span class="ansi-green-intense-fg ansi-bold">    142</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/exoplanet/sampling.py</span> in <span class="ansi-cyan-fg">_extend</span><span class="ansi-blue-fg">(self, steps, start, step, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    126</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>         self._current_trace = pm.sample(
<span class="ansi-green-fg">--&gt; 128</span><span class="ansi-red-fg">             </span>start<span class="ansi-blue-fg">=</span>start<span class="ansi-blue-fg">,</span> tune<span class="ansi-blue-fg">=</span>steps<span class="ansi-blue-fg">,</span> step<span class="ansi-blue-fg">=</span>step<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs
<span class="ansi-green-intense-fg ansi-bold">    129</span>         )
<span class="ansi-green-intense-fg ansi-bold">    130</span>         self<span class="ansi-blue-fg">.</span>count <span class="ansi-blue-fg">+=</span> steps

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">sample</span><span class="ansi-blue-fg">(draws, step, init, n_init, start, trace, chain_idx, chains, cores, tune, nuts_kwargs, step_kwargs, progressbar, model, random_seed, live_plot, discard_tuned_samples, live_plot_kwargs, compute_convergence_checks, use_mmap, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    447</span>             _print_step_hierarchy<span class="ansi-blue-fg">(</span>step<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    448</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 449</span><span class="ansi-red-fg">                 </span>trace <span class="ansi-blue-fg">=</span> _mp_sample<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>sample_args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    450</span>             <span class="ansi-green-fg">except</span> pickle<span class="ansi-blue-fg">.</span>PickleError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    451</span>                 _log<span class="ansi-blue-fg">.</span>warning<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Could not pickle model, sampling singlethreaded.&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_mp_sample</span><span class="ansi-blue-fg">(draws, tune, step, chains, cores, chain, random_seed, start, progressbar, trace, model, use_mmap, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1009</span>             <span class="ansi-green-fg">return</span> MultiTrace<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1010</span>         <span class="ansi-green-fg">except</span> KeyboardInterrupt<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1011</span><span class="ansi-red-fg">             </span>traces<span class="ansi-blue-fg">,</span> length <span class="ansi-blue-fg">=</span> _choose_chains<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">,</span> tune<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1012</span>             <span class="ansi-green-fg">return</span> MultiTrace<span class="ansi-blue-fg">(</span>traces<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>length<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">   1013</span>         <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pymc3/sampling.py</span> in <span class="ansi-cyan-fg">_choose_chains</span><span class="ansi-blue-fg">(traces, tune)</span>
<span class="ansi-green-intense-fg ansi-bold">   1042</span>     lengths <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>max<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> len<span class="ansi-blue-fg">(</span>trace<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> tune<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> trace <span class="ansi-green-fg">in</span> traces<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">   1043</span>     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> sum<span class="ansi-blue-fg">(</span>lengths<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1044</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Not enough samples to build a trace.&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1045</span>
<span class="ansi-green-intense-fg ansi-bold">   1046</span>     idxs <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>argsort<span class="ansi-blue-fg">(</span>lengths<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span>

<span class="ansi-red-fg">ValueError</span>: Not enough samples to build a trace.
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: AstropyDeprecationWarning: Importing LombScargle from astropy.stats has been deprecated and will no longer be supported in future. Please import this class from the astropy.timeseries module instead [astropy.stats.lombscargle]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_50_1.png" src="../_images/case_studies_10080943_50_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">opt</span> <span class="o">=</span> <span class="n">map_params</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">opt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;logP_interval__&#39;: array(-0.05304152),
 &#39;phi_angle__&#39;: array([2.84697063, 3.448891  ]),
 &#39;logs_lc&#39;: array(0.27237454),
 &#39;asini_interval__&#39;: array([ 1.19710235, -0.8571673 , -0.98050136]),
 &#39;omega_angle__&#39;: array([-0.68829479,  4.41884616]),
 &#39;mean&#39;: array(-0.04298838),
 &#39;lognu&#39;: array([2.63530639, 2.75259836, 2.52192766]),
 &#39;phase_angle__&#39;: array([[-1.75645807,  3.17034142,  1.76290606],
        [ 4.11276393,  3.15417836, -4.11000361]]),
 &#39;logamp&#39;: array([ 0.30917564,  0.22535038, -0.06669878]),
 &#39;logw0_interval__&#39;: array(9.29309804),
 &#39;logpower&#39;: array(9.04306205),
 &#39;logP&#39;: array(2.73020446),
 &#39;period&#39;: array(15.33602234),
 &#39;phi&#39;: array(0.69008215),
 &#39;asini&#39;: array([ 53.60178129, -40.41369651, -45.44153712]),
 &#39;omega&#39;: array(-0.15452177),
 &#39;nu&#39;: array([13.94758524, 15.68332996, 12.45257786]),
 &#39;phase&#39;: array([-0.40362676,  0.78795378,  2.73639752]),
 &#39;logw0&#39;: array(1.14436979),
 &#39;logS0&#39;: array(4.4655829)}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pinned_lt</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">53.60178129</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">43.</span>
<span class="p">]</span>
<span class="n">nu_arr_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="mf">13.94758524</span>
<span class="p">])</span>
<span class="n">nu_arr_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="mf">15.68332996</span><span class="p">,</span> <span class="mf">12.45257786</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lt</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;asini&#39;</span><span class="p">]</span>

<span class="n">lt_ivar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">lt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">)</span>
<span class="n">mask_lower</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">mask_upper</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">&gt;</span> <span class="mf">1.0</span>

<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_lower</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_upper</span><span class="p">):</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">lt</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="o">~</span><span class="n">m1</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m1</span><span class="p">]</span><span class="o">*</span><span class="n">lt</span><span class="p">[</span><span class="n">m1</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m1</span><span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m2</span><span class="p">]</span><span class="o">*</span><span class="n">lt</span><span class="p">[</span><span class="n">m2</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">[</span><span class="n">m2</span><span class="p">]),</span>
    <span class="p">])</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">m1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lt</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="o">*</span><span class="n">lt</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lt_ivar</span><span class="p">)])</span>
<span class="n">pinned_lt</span> <span class="o">=</span> <span class="n">lt</span>

<span class="c1"># Get frequencies for each star</span>
<span class="n">nu_arr_negative</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inds</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">nu_arr_positive</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inds</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">exoplanet.orbits</span> <span class="kn">import</span> <span class="n">get_true_anomaly</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">pb2_model</span><span class="p">:</span>
    <span class="n">logP</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span>
                    <span class="n">lower</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                    <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">50</span><span class="p">))(</span><span class="s2">&quot;logP&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
                                      <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]))</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logP</span><span class="p">))</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">)</span>
    <span class="n">logs_lc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logs_lc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">flux</span><span class="p">)))),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">flux</span><span class="p">)))))</span>
    <span class="n">asini_neg</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;asini_pos&quot;</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sd</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">asini_pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;asini_neg&quot;</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sd</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">)</span>
    <span class="n">eccen</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;eccen&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.444</span><span class="p">)</span>

    <span class="n">M</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">time</span> <span class="o">/</span> <span class="n">period</span> <span class="o">-</span> <span class="n">phi</span>
    <span class="c1"># True anom</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">get_true_anomaly</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">eccen</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">eccen</span><span class="p">))</span> <span class="o">*</span> <span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="o">+</span><span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eccen</span><span class="o">*</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="n">lognu_pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;lognu_pos&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nu_arr_positive</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nu_arr_positive</span><span class="p">))</span>
    <span class="n">nu_pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;nu_pos&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lognu_pos</span><span class="p">))</span>
    <span class="n">lognu_neg</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;lognu_neg&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nu_arr_negative</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nu_arr_negative</span><span class="p">))</span>
    <span class="n">nu_neg</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;nu_neg&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lognu_neg</span><span class="p">))</span>

    <span class="c1">#  Positive</span>
<span class="c1">#     arg = 2. * np.pi * nu_pos[None, :] * (time[:, None] - (asini_pos / 86400.) * psi[:, None])</span>
<span class="c1">#     W_hat_cos_pos = pm.Normal(&quot;W_hat_cos_pos&quot;, mu=0.0, sd=100.0,shape=len(nu_arr_positive))</span>
<span class="c1">#     W_hat_sin_pos = pm.Normal(&quot;W_hat_sin_pos&quot;, mu=0.0, sd=100.0,shape=len(nu_arr_positive))</span>
<span class="c1">#     model_tensor = tt.dot(tt.cos(arg), W_hat_cos_pos[:, None]) + tt.dot(tt.sin(arg), W_hat_sin_pos[:, None])</span>
<span class="c1">#     lc_model = tt.squeeze(model_tensor)</span>

<span class="c1">#     #  Negative</span>
<span class="c1">#     arg = 2. * np.pi * nu_neg[None, :] * (time[:, None] - (asini_neg / 86400.) * psi[:, None])</span>
<span class="c1">#     W_hat_cos_neg = pm.Normal(&quot;W_hat_cos_neg&quot;, mu=0.0, sd=100.0,shape=len(nu_arr_negative))</span>
<span class="c1">#     W_hat_sin_neg = pm.Normal(&quot;W_hat_sin_neg&quot;, mu=0.0, sd=100.0,shape=len(nu_arr_negative))</span>
<span class="c1">#     model_tensor = tt.dot(tt.cos(arg), W_hat_cos_neg[:, None]) + tt.dot(tt.sin(arg), W_hat_sin_neg[:, None])</span>
<span class="c1">#     lc_model += tt.squeeze(model_tensor)</span>

<span class="c1">#     # Positive</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">nu_pos</span> <span class="o">*</span> <span class="p">(</span><span class="n">time</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">asini_pos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DT</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">T</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">slinalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">D</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">flux</span><span class="p">))</span>
    <span class="n">lc_model</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="c1"># Negative</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">nu_neg</span> <span class="o">*</span> <span class="p">(</span><span class="n">time</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">asini_neg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DT</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">T</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">slinalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">D</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">flux</span><span class="p">))</span>
    <span class="n">lc_model</span> <span class="o">+=</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="c1">#GP parameters</span>
<span class="c1">#     logw0 = logw0 = pm.Bound(pm.Normal,</span>
<span class="c1">#                      lower=np.log(2*np.pi/100.0),</span>
<span class="c1">#                      upper=np.log(2*np.pi/1.0))(&quot;logw0&quot;, mu=np.log(2*np.pi/10), sd=10,</span>
<span class="c1">#                                                 testval=np.log(2*np.pi/10))</span>
<span class="c1">#     logpower = pm.Normal(&quot;logpower&quot;, mu=np.log(np.var(flux)), sd=10)</span>
<span class="c1">#     logS0 = pm.Deterministic(&quot;logS0&quot;, logpower - 4 * logw0)</span>
<span class="c1">#     kernel = xo.gp.terms.SHOTerm(log_S0=logS0, log_w0=logw0, Q=1/np.sqrt(2))</span>
<span class="c1">#     gp = xo.gp.GP(kernel, time, tt.exp(2*logs_lc) + tt.zeros(len(time)), J=2)</span>

<span class="c1">#     full_lc = lc_model + mean</span>
<span class="c1">#     gp_l = gp.log_likelihood(flux - full_lc)</span>
<span class="c1">#     #Weight likelihood equally with RV data</span>
<span class="c1">#     pm.Potential(&quot;obs&quot;, gp_l)</span>

    <span class="n">full_lc</span> <span class="o">=</span> <span class="n">lc_model</span> <span class="o">+</span> <span class="n">mean</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">full_lc</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logs_lc</span><span class="p">),</span> <span class="n">observed</span><span class="o">=</span><span class="n">flux</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb2_model</span><span class="p">:</span>
    <span class="n">all_but</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pb2_model</span><span class="o">.</span><span class="n">vars</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;logP_interval__&quot;</span><span class="p">]]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">mean</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logs_lc</span><span class="p">])</span>
<span class="c1">#     map_params = xo.optimize(start=map_params, vars=[logpower, logw0])</span>
<span class="c1">#     map_params = xo.optimize(start=map_params, vars=[W_hat_cos_neg, W_hat_cos_pos, W_hat_sin_neg, W_hat_sin_pos])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">phi</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">lognu_pos</span><span class="p">,</span> <span class="n">lognu_neg</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">asini_pos</span><span class="p">,</span> <span class="n">asini_neg</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">omega</span><span class="p">,</span> <span class="n">eccen</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

<span class="c1">#     map_params = xo.optimize(start=map_params, vars=[logP])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">period</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>
<span class="c1">#     map_params = xo.optimize(start=map_params)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[phi_angle__, logs_lc, asini_pos, asini_neg, mean, omega_angle__, eccen_interval__, lognu_pos, lognu_neg]
optimizing logp for variables: [&#39;mean&#39;]
message: Optimization terminated successfully.
logp: -264403.4710434688 -&gt; -264403.4703756111
optimizing logp for variables: [&#39;logs_lc&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -264403.4703756111 -&gt; -191709.93378942844
optimizing logp for variables: [&#39;phi_angle__&#39;]
message: Optimization terminated successfully.
logp: -191709.93378942844 -&gt; -191678.5181225986
optimizing logp for variables: [&#39;lognu_neg&#39;, &#39;lognu_pos&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -191678.5181225986 -&gt; -191678.50112266222
optimizing logp for variables: [&#39;lognu_neg&#39;, &#39;lognu_pos&#39;, &#39;eccen_interval__&#39;, &#39;omega_angle__&#39;, &#39;mean&#39;, &#39;asini_neg&#39;, &#39;asini_pos&#39;, &#39;logs_lc&#39;, &#39;phi_angle__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -191678.50112266222 -&gt; -191678.50112266184
optimizing logp for variables: [&#39;asini_pos&#39;, &#39;asini_neg&#39;]
message: Optimization terminated successfully.
logp: -191678.50112266184 -&gt; -191678.40882854586
optimizing logp for variables: [&#39;eccen_interval__&#39;, &#39;omega_angle__&#39;]
message: Optimization terminated successfully.
logp: -191678.40882854586 -&gt; -191657.93669078787
optimizing logp for variables: [&#39;lognu_neg&#39;, &#39;lognu_pos&#39;, &#39;eccen_interval__&#39;, &#39;omega_angle__&#39;, &#39;mean&#39;, &#39;asini_neg&#39;, &#39;asini_pos&#39;, &#39;logs_lc&#39;, &#39;phi_angle__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -191657.93669078787 -&gt; -191657.38352164047
optimizing logp for variables: [&#39;logP_interval__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -191657.38352164047 -&gt; -191657.38180303088
optimizing logp for variables: [&#39;lognu_neg&#39;, &#39;lognu_pos&#39;, &#39;eccen_interval__&#39;, &#39;omega_angle__&#39;, &#39;mean&#39;, &#39;asini_neg&#39;, &#39;asini_pos&#39;, &#39;logs_lc&#39;, &#39;phi_angle__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -191657.38180303088 -&gt; -191657.381638973
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">map_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;logP_interval__&#39;: array(-0.05155323),
 &#39;phi_angle__&#39;: array([3.85765665, 2.26240394]),
 &#39;logs_lc&#39;: array(1.5181755),
 &#39;asini_pos&#39;: array(49.06203725),
 &#39;asini_neg&#39;: array(-48.97406846),
 &#39;mean&#39;: array(0.0003904),
 &#39;omega_angle__&#39;: array([-1.0650696 , -4.34345715]),
 &#39;eccen_interval__&#39;: array(-0.0423049),
 &#39;lognu_pos&#39;: array([2.63530638]),
 &#39;lognu_neg&#39;: array([2.75259833, 2.52192753]),
 &#39;logP&#39;: array(2.73106061),
 &#39;period&#39;: array(15.3491578),
 &#39;phi&#39;: array(1.04038398),
 &#39;omega&#39;: array(-2.90112501),
 &#39;eccen&#39;: array(0.48893593),
 &#39;nu_pos&#39;: array([13.94758513]),
 &#39;nu_neg&#39;: array([15.6833294 , 12.45257629])}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb2_model</span><span class="p">:</span>
    <span class="n">fold_time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fold_time</span><span class="p">)</span>

    <span class="n">td_pos</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">asini_pos</span> <span class="o">*</span> <span class="n">psi</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)</span>
    <span class="n">td_neg</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">asini_neg</span> <span class="o">*</span> <span class="n">psi</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">td_pos</span><span class="p">[</span><span class="n">sort</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">td_neg</span><span class="p">[</span><span class="n">sort</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_58_0.png" src="../_images/case_studies_10080943_58_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[103]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">PyMC3Sampler</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="k">with</span> <span class="n">pb2_model</span><span class="p">:</span>
    <span class="n">burnin</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">step_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains: 100%|██████████| 308/308 [26:45&lt;00:00, 12.61s/draws]
Sampling 4 chains: 100%|██████████| 208/208 [17:42&lt;00:00, 17.50s/draws]
Sampling 4 chains: 100%|██████████| 408/408 [38:13&lt;00:00, 13.15s/draws]
Sampling 4 chains: 100%|██████████| 808/808 [54:41&lt;00:00, 14.53s/draws]
Sampling 4 chains:  85%|████████▌ | 1962/2308 [6:23:42&lt;1:37:38, 16.93s/draws]

KeyboardInterrupt

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb2_model</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Maelstrom-+-RV">
<h2>Maelstrom + RV<a class="headerlink" href="#Maelstrom-+-RV" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rv_jd_a</span><span class="p">,</span> <span class="n">rv_rv_a</span><span class="p">,</span> <span class="n">rv_err_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data/kic10080943a_JDrv.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">rv_jd_a</span> <span class="o">+=</span> <span class="mi">2400000</span>
<span class="n">rv_jd_a</span> <span class="o">-=</span> <span class="mi">2454833</span>
<span class="n">rv_jd_a</span> <span class="o">-=</span> <span class="n">ms</span><span class="o">.</span><span class="n">time_mid</span>

<span class="n">rv_jd_b</span><span class="p">,</span> <span class="n">rv_rv_b</span><span class="p">,</span> <span class="n">rv_err_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data/kic10080943b_JDrv.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">rv_jd_b</span> <span class="o">+=</span> <span class="mi">2400000</span>
<span class="n">rv_jd_b</span> <span class="o">-=</span> <span class="mi">2454833</span>
<span class="n">rv_jd_b</span> <span class="o">-=</span> <span class="n">ms</span><span class="o">.</span><span class="n">time_mid</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="mf">15.33</span> <span class="o">/</span> <span class="mf">15.33</span><span class="p">,</span> <span class="n">rv_rv_a</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_b</span> <span class="o">%</span> <span class="mf">15.33</span> <span class="o">/</span> <span class="mf">15.33</span><span class="p">,</span> <span class="n">rv_rv_b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x1c31f5fe10&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_64_1.png" src="../_images/case_studies_10080943_64_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">exoplanet.orbits</span> <span class="kn">import</span> <span class="n">get_true_anomaly</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>
<span class="kn">import</span> <span class="nn">theano</span>

<span class="n">rv_time_tensor_a</span> <span class="o">=</span> <span class="n">theano</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">)</span>
<span class="n">rv_rv_tensor_a</span> <span class="o">=</span> <span class="n">theano</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">rv_rv_a</span><span class="p">)</span>

<span class="n">rv_time_tensor_b</span> <span class="o">=</span> <span class="n">theano</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">rv_jd_b</span><span class="p">)</span>
<span class="n">rv_rv_tensor_b</span> <span class="o">=</span> <span class="n">theano</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">rv_rv_b</span><span class="p">)</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="n">logP</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span>
                    <span class="n">lower</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                    <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">50</span><span class="p">))(</span><span class="s2">&quot;logP&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">15.3356</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                                      <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">15.3356</span><span class="p">))</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logP</span><span class="p">))</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">)</span>
    <span class="n">logs_lc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logs_lc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">flux</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">asini_pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;asini_pos&quot;</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">asini_neg</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;asini_neg&quot;</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">pinned_lt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">)</span>
    <span class="n">eccen</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;eccen&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.444</span><span class="p">)</span>

    <span class="n">M</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">time</span> <span class="o">/</span> <span class="n">period</span> <span class="o">-</span> <span class="n">phi</span>
    <span class="c1"># True anom</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">get_true_anomaly</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">eccen</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">eccen</span><span class="p">))</span> <span class="o">*</span> <span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="o">+</span><span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eccen</span><span class="o">*</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="n">lognu_pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;lognu_pos&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nu_arr_positive</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nu_arr_positive</span><span class="p">))</span>
    <span class="n">nu_pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;nu_pos&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lognu_pos</span><span class="p">))</span>
    <span class="n">lognu_neg</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;lognu_neg&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nu_arr_negative</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nu_arr_negative</span><span class="p">))</span>
    <span class="n">nu_neg</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;nu_neg&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lognu_neg</span><span class="p">))</span>

    <span class="c1"># Positive</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">nu_pos</span> <span class="o">*</span> <span class="p">(</span><span class="n">time</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">asini_pos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DT</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">T</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">slinalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">D</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">flux</span><span class="p">))</span>
    <span class="n">lc_model</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="c1"># Negative</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">nu_neg</span> <span class="o">*</span> <span class="p">(</span><span class="n">time</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">asini_neg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DT</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">T</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">slinalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">D</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span> <span class="n">flux</span><span class="p">))</span>
    <span class="n">lc_model</span> <span class="o">+=</span> <span class="n">tt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="c1"># GP parameters</span>
<span class="c1">#     logw0 = logw0 = pm.Bound(pm.Normal,</span>
<span class="c1">#                      lower=np.log(2*np.pi/100.0),</span>
<span class="c1">#                      upper=np.log(2*np.pi/1.0))(&quot;logw0&quot;, mu=np.log(2*np.pi/10), sd=10,</span>
<span class="c1">#                                                 testval=np.log(2*np.pi/10))</span>
<span class="c1">#     logpower = pm.Normal(&quot;logpower&quot;, mu=np.log(np.var(flux)), sd=10)</span>
<span class="c1">#     logS0 = pm.Deterministic(&quot;logS0&quot;, logpower - 4 * logw0)</span>
<span class="c1">#     kernel = xo.gp.terms.SHOTerm(log_S0=logS0, log_w0=logw0, Q=1/np.sqrt(2))</span>
<span class="c1">#     gp = xo.gp.GP(kernel, time, tt.exp(2*logs_lc) + tt.zeros(len(time)), J=2)</span>

    <span class="n">full_lc</span> <span class="o">=</span> <span class="n">lc_model</span> <span class="o">+</span> <span class="n">mean</span>
<span class="c1">#     gp_l = gp.log_likelihood(flux - full_lc)</span>
<span class="c1">#     #Weight likelihood equally with RV data</span>
<span class="c1">#     pm.Potential(&quot;obs&quot;, gp_l)</span>


    <span class="c1"># RADIAL VELOCITIES</span>
    <span class="n">logs_rv_a</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logs_RV_a&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">logs_rv_b</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;logs_RV_b&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">gammav</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;gammav&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>

    <span class="c1"># Positive</span>
    <span class="n">rv_mean_anom</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rv_time_tensor_a</span> <span class="o">/</span> <span class="n">period</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">rv_true_anom</span> <span class="o">=</span> <span class="n">get_true_anomaly</span><span class="p">(</span><span class="n">rv_mean_anom</span><span class="p">,</span> <span class="n">eccen</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rv_mean_anom</span><span class="p">))</span>
    <span class="n">rv_vrad_a</span> <span class="o">=</span> <span class="p">((</span><span class="n">asini_pos</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">tt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">eccen</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rv_true_anom</span> <span class="o">+</span> <span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">eccen</span><span class="o">*</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="p">))))</span>
    <span class="n">rv_vrad_a</span> <span class="o">*=</span> <span class="mf">299792.458</span>  <span class="c1"># c in km/s</span>
    <span class="n">rv_vrad_a</span> <span class="o">+=</span> <span class="n">gammav</span>

    <span class="c1"># Negative</span>
    <span class="n">rv_mean_anom</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rv_time_tensor_b</span> <span class="o">/</span> <span class="n">period</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">rv_true_anom</span> <span class="o">=</span> <span class="n">get_true_anomaly</span><span class="p">(</span><span class="n">rv_mean_anom</span><span class="p">,</span> <span class="n">eccen</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rv_mean_anom</span><span class="p">))</span>
    <span class="n">rv_vrad_b</span> <span class="o">=</span> <span class="p">((</span><span class="n">asini_neg</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">tt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">eccen</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rv_true_anom</span> <span class="o">+</span> <span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">eccen</span><span class="o">*</span><span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="p">))))</span>
    <span class="n">rv_vrad_b</span> <span class="o">*=</span> <span class="mf">299792.458</span>  <span class="c1"># c in km/s</span>
    <span class="n">rv_vrad_b</span> <span class="o">+=</span> <span class="n">gammav</span>

    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;obs_radial_velocity_a&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">rv_vrad_a</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logs_rv_a</span><span class="p">),</span> <span class="n">observed</span><span class="o">=</span><span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;obs_radial_velocity_b&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">rv_vrad_b</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logs_rv_b</span><span class="p">),</span> <span class="n">observed</span><span class="o">=</span><span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;obs_lc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">full_lc</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logs_lc</span><span class="p">),</span> <span class="n">observed</span><span class="o">=</span><span class="n">flux</span><span class="p">)</span>
<span class="c1">#     full_lc = lc_model + mean</span>
<span class="c1">#     pm.Normal(&#39;obs&#39;, mu=full_lc, sd=tt.exp(logs_lc), observed=flux)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="n">all_but</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pb2_model_RV</span><span class="o">.</span><span class="n">vars</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;logP_interval__&quot;</span><span class="p">,</span> <span class="s2">&quot;logasini_interval__&quot;</span><span class="p">]]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">mean</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logs_lc</span><span class="p">,</span> <span class="n">logs_rv_a</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">gammav</span><span class="p">])</span>
<span class="c1">#     map_params = xo.optimize(start=map_params, vars=[phase, logamp])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">eccen</span><span class="p">,</span> <span class="n">omega</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">phi</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">nu_pos</span><span class="p">,</span> <span class="n">nu_neg</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">asini_pos</span><span class="p">,</span> <span class="n">asini_neg</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logP</span><span class="p">])</span>
    <span class="n">map_params</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">all_but</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="mf">15.33</span> <span class="o">/</span> <span class="mf">15.33</span><span class="p">,</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_a</span><span class="p">,</span> <span class="n">map_params</span><span class="p">))</span>
<span class="c1">#     map_params = xo.optimize(start=map_params)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[phi_angle__, logs_lc, asini_pos, asini_neg, mean, omega_angle__, eccen_interval__, lognu_pos, lognu_neg, logs_RV_a, logs_RV_b, gammav]
optimizing logp for variables: [&#39;mean&#39;]
message: Optimization terminated successfully.
logp: -794763.9144321176 -&gt; -794763.9143904693
optimizing logp for variables: [&#39;logs_RV_a&#39;, &#39;logs_lc&#39;]
message: Optimization terminated successfully.
logp: -794763.9143904693 -&gt; -223197.9943471864
optimizing logp for variables: [&#39;gammav&#39;]
message: Optimization terminated successfully.
logp: -223197.9943471864 -&gt; -220448.23359201144
optimizing logp for variables: [&#39;omega_angle__&#39;, &#39;eccen_interval__&#39;]
message: Optimization terminated successfully.
logp: -220448.23359201144 -&gt; -196143.84383143304
optimizing logp for variables: [&#39;phi_angle__&#39;]
message: Optimization terminated successfully.
logp: -196143.84383143304 -&gt; -196013.9415108297
optimizing logp for variables: [&#39;lognu_neg&#39;, &#39;lognu_pos&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -196013.9415108297 -&gt; -196013.91453271103
optimizing logp for variables: [&#39;gammav&#39;, &#39;logs_RV_b&#39;, &#39;logs_RV_a&#39;, &#39;lognu_neg&#39;, &#39;lognu_pos&#39;, &#39;eccen_interval__&#39;, &#39;omega_angle__&#39;, &#39;mean&#39;, &#39;asini_neg&#39;, &#39;asini_pos&#39;, &#39;logs_lc&#39;, &#39;phi_angle__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -196013.91453271103 -&gt; -190934.58753482753
optimizing logp for variables: [&#39;asini_neg&#39;, &#39;asini_pos&#39;]
message: Optimization terminated successfully.
logp: -190934.58753482753 -&gt; -190934.58753482753
optimizing logp for variables: [&#39;gammav&#39;, &#39;logs_RV_b&#39;, &#39;logs_RV_a&#39;, &#39;lognu_neg&#39;, &#39;lognu_pos&#39;, &#39;eccen_interval__&#39;, &#39;omega_angle__&#39;, &#39;mean&#39;, &#39;asini_neg&#39;, &#39;asini_pos&#39;, &#39;logs_lc&#39;, &#39;phi_angle__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -190934.58753482753 -&gt; -190934.5875348261
optimizing logp for variables: [&#39;logP_interval__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -190934.5875348261 -&gt; -190932.96191555914
optimizing logp for variables: [&#39;gammav&#39;, &#39;logs_RV_b&#39;, &#39;logs_RV_a&#39;, &#39;lognu_neg&#39;, &#39;lognu_pos&#39;, &#39;eccen_interval__&#39;, &#39;omega_angle__&#39;, &#39;mean&#39;, &#39;asini_neg&#39;, &#39;asini_pos&#39;, &#39;logs_lc&#39;, &#39;phi_angle__&#39;]
message: Desired error not necessarily achieved due to precision loss.
logp: -190932.96191555914 -&gt; -190931.24357961564
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_66_1.png" src="../_images/case_studies_10080943_66_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>

<span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>

    <span class="n">fold_time</span> <span class="o">=</span> <span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fold_time</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_a</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_a</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_b</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_b</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_b</span><span class="p">)</span>


<span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">)</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_a</span><span class="p">)</span>

<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_b</span><span class="p">)</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_b</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Orbital phase&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;RV (km/s)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;RV (km/s)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_67_1.png" src="../_images/case_studies_10080943_67_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>

<span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="n">fold_time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fold_time</span><span class="p">)</span>

    <span class="n">td_pos</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">asini_pos</span> <span class="o">*</span> <span class="n">psi</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)</span>
    <span class="n">td_neg</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">asini_neg</span> <span class="o">*</span> <span class="n">psi</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">td_pos</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">td_neg</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time delay (s)&#39;</span><span class="p">)</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">fold_time</span> <span class="o">=</span> <span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fold_time</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_a</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_a</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_b</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_b</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>

<span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">)</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_a</span><span class="p">)</span>

<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_b</span><span class="p">)</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_b</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Orbital phase&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RV (km/s)&#39;</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;RV (km/s)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_68_1.png" src="../_images/case_studies_10080943_68_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">PyMC3Sampler</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="n">burnin</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">step_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="n">map_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains: 100%|██████████| 154/154 [25:27&lt;00:00, 22.88s/draws]
Sampling 2 chains: 100%|██████████| 404/404 [1:04:06&lt;00:00, 15.68s/draws]
Sampling 2 chains: 100%|██████████| 1454/1454 [1:14:48&lt;00:00,  4.89s/draws]
Sampling 2 chains: 100%|██████████| 1004/1004 [09:20&lt;00:00,  1.36draws/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [gammav, logs_RV_b, logs_RV_a, lognu_neg, lognu_pos, eccen, omega, mean, asini_neg, asini_pos, logs_lc, phi, logP]
Sampling 2 chains: 100%|██████████| 2000/2000 [19:37&lt;00:00,  1.26draws/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>mc_error</th>
      <th>hpd_2.5</th>
      <th>hpd_97.5</th>
      <th>n_eff</th>
      <th>Rhat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>logs_lc</th>
      <td>1.505374</td>
      <td>2.791965e-03</td>
      <td>5.074587e-05</td>
      <td>1.499990</td>
      <td>1.510728</td>
      <td>3196.340603</td>
      <td>0.999706</td>
    </tr>
    <tr>
      <th>asini_pos</th>
      <td>44.939928</td>
      <td>1.859542e-01</td>
      <td>3.730975e-03</td>
      <td>44.601160</td>
      <td>45.320801</td>
      <td>2232.433828</td>
      <td>1.003734</td>
    </tr>
    <tr>
      <th>asini_neg</th>
      <td>-43.164430</td>
      <td>1.459248e-01</td>
      <td>2.753235e-03</td>
      <td>-43.448645</td>
      <td>-42.882756</td>
      <td>2541.981270</td>
      <td>0.999571</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.000251</td>
      <td>1.773215e-02</td>
      <td>3.212764e-04</td>
      <td>-0.035832</td>
      <td>0.033215</td>
      <td>3216.097312</td>
      <td>0.999866</td>
    </tr>
    <tr>
      <th>lognu_pos__0</th>
      <td>2.635306</td>
      <td>4.902410e-07</td>
      <td>9.115598e-09</td>
      <td>2.635305</td>
      <td>2.635307</td>
      <td>2752.307907</td>
      <td>0.999522</td>
    </tr>
    <tr>
      <th>lognu_pos__1</th>
      <td>2.653477</td>
      <td>1.992874e-06</td>
      <td>3.438912e-08</td>
      <td>2.653473</td>
      <td>2.653481</td>
      <td>3053.138780</td>
      <td>0.999506</td>
    </tr>
    <tr>
      <th>lognu_neg__0</th>
      <td>2.752598</td>
      <td>4.675916e-07</td>
      <td>9.811853e-09</td>
      <td>2.752598</td>
      <td>2.752599</td>
      <td>2820.092555</td>
      <td>0.999541</td>
    </tr>
    <tr>
      <th>lognu_neg__1</th>
      <td>2.521927</td>
      <td>8.056798e-07</td>
      <td>1.400438e-08</td>
      <td>2.521926</td>
      <td>2.521929</td>
      <td>3137.253595</td>
      <td>0.999674</td>
    </tr>
    <tr>
      <th>lognu_neg__2</th>
      <td>2.556494</td>
      <td>9.788879e-07</td>
      <td>1.822999e-08</td>
      <td>2.556492</td>
      <td>2.556496</td>
      <td>3193.144832</td>
      <td>0.999993</td>
    </tr>
    <tr>
      <th>lognu_neg__3</th>
      <td>2.850998</td>
      <td>8.970943e-07</td>
      <td>1.743723e-08</td>
      <td>2.850996</td>
      <td>2.851000</td>
      <td>3013.964584</td>
      <td>0.999838</td>
    </tr>
    <tr>
      <th>logs_RV_a</th>
      <td>-0.014674</td>
      <td>1.583377e-01</td>
      <td>3.247754e-03</td>
      <td>-0.297979</td>
      <td>0.308896</td>
      <td>2265.071658</td>
      <td>0.999568</td>
    </tr>
    <tr>
      <th>logs_RV_b</th>
      <td>-0.250021</td>
      <td>1.640359e-01</td>
      <td>3.377739e-03</td>
      <td>-0.548067</td>
      <td>0.075606</td>
      <td>2332.310824</td>
      <td>1.000122</td>
    </tr>
    <tr>
      <th>gammav</th>
      <td>-22.865462</td>
      <td>1.292413e-01</td>
      <td>2.557174e-03</td>
      <td>-23.114060</td>
      <td>-22.606125</td>
      <td>2673.717894</td>
      <td>1.000419</td>
    </tr>
    <tr>
      <th>logP</th>
      <td>2.730220</td>
      <td>1.578203e-05</td>
      <td>3.652172e-07</td>
      <td>2.730187</td>
      <td>2.730249</td>
      <td>1885.452828</td>
      <td>0.999749</td>
    </tr>
    <tr>
      <th>period</th>
      <td>15.336257</td>
      <td>2.420371e-04</td>
      <td>5.601060e-06</td>
      <td>15.335761</td>
      <td>15.336705</td>
      <td>1885.455054</td>
      <td>0.999749</td>
    </tr>
    <tr>
      <th>phi</th>
      <td>0.593248</td>
      <td>8.842523e-03</td>
      <td>2.050051e-04</td>
      <td>0.576717</td>
      <td>0.611303</td>
      <td>1608.894132</td>
      <td>0.999690</td>
    </tr>
    <tr>
      <th>omega</th>
      <td>-0.269973</td>
      <td>7.671390e-03</td>
      <td>1.592557e-04</td>
      <td>-0.285719</td>
      <td>-0.255600</td>
      <td>1805.725501</td>
      <td>0.999502</td>
    </tr>
    <tr>
      <th>eccen</th>
      <td>0.453255</td>
      <td>2.300451e-03</td>
      <td>4.609963e-05</td>
      <td>0.448672</td>
      <td>0.457444</td>
      <td>2655.311820</td>
      <td>0.999500</td>
    </tr>
    <tr>
      <th>nu_pos__0</th>
      <td>13.947585</td>
      <td>6.837678e-06</td>
      <td>1.271406e-07</td>
      <td>13.947572</td>
      <td>13.947599</td>
      <td>2752.307956</td>
      <td>0.999522</td>
    </tr>
    <tr>
      <th>nu_pos__1</th>
      <td>14.203336</td>
      <td>2.830547e-05</td>
      <td>4.884402e-07</td>
      <td>14.203282</td>
      <td>14.203392</td>
      <td>3053.139932</td>
      <td>0.999506</td>
    </tr>
    <tr>
      <th>nu_neg__0</th>
      <td>15.683330</td>
      <td>7.333392e-06</td>
      <td>1.538825e-07</td>
      <td>15.683317</td>
      <td>15.683345</td>
      <td>2820.093306</td>
      <td>0.999541</td>
    </tr>
    <tr>
      <th>nu_neg__1</th>
      <td>12.452575</td>
      <td>1.003279e-05</td>
      <td>1.743905e-07</td>
      <td>12.452556</td>
      <td>12.452595</td>
      <td>3137.253841</td>
      <td>0.999674</td>
    </tr>
    <tr>
      <th>nu_neg__2</th>
      <td>12.890541</td>
      <td>1.261839e-05</td>
      <td>2.349945e-07</td>
      <td>12.890518</td>
      <td>12.890567</td>
      <td>3193.145361</td>
      <td>0.999993</td>
    </tr>
    <tr>
      <th>nu_neg__3</th>
      <td>17.305041</td>
      <td>1.552425e-05</td>
      <td>3.017520e-07</td>
      <td>17.305010</td>
      <td>17.305070</td>
      <td>3013.964816</td>
      <td>0.999838</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">load_trace</span><span class="p">(</span><span class="s1">&#39;traces/10080943_rv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">corner</span>

<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">trace_to_dataframe</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span>
                                    <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;asini_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;asini_neg&#39;</span><span class="p">,</span> <span class="s1">&#39;gammav&#39;</span><span class="p">,</span><span class="s1">&#39;period&#39;</span><span class="p">,</span><span class="s1">&#39;phi&#39;</span><span class="p">,</span><span class="s1">&#39;eccen&#39;</span><span class="p">,</span><span class="s1">&#39;omega&#39;</span><span class="p">]),</span>
             <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>

<span class="c1"># plt.savefig(&#39;10080943.png&#39;, dpi=300,bbox_inches=&#39;tight&#39;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_73_0.png" src="../_images/case_studies_10080943_73_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">maelstrom.utils</span> <span class="kn">import</span> <span class="n">mass_function</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="n">rounding</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">trace_to_dataframe</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;asini_pos&#39;</span><span class="p">])</span>
<span class="n">mfs</span> <span class="o">=</span> <span class="n">mass_function</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="s1">&#39;asini_pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="c1">#mfs = np.array(mfs)</span>
<span class="n">upper</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mfs</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">[</span><span class="mf">84.13</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">15.86</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mass_func&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">med</span><span class="p">,</span><span class="n">rounding</span><span class="p">),</span> <span class="s1">&#39; + &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">med</span><span class="p">,</span><span class="n">rounding</span><span class="p">),</span> <span class="s1">&#39; - &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">med</span> <span class="o">-</span> <span class="n">lower</span><span class="p">,</span><span class="n">rounding</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mass_func :  0.414  +  0.005  -  0.005
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;asini_pos&#39;</span><span class="p">,</span><span class="s1">&#39;asini_neg&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;eccen&#39;</span><span class="p">,</span> <span class="s1">&#39;omega&#39;</span><span class="p">,</span><span class="s1">&#39;gammav&#39;</span><span class="p">]</span>
<span class="n">rounding</span> <span class="o">=</span> <span class="mi">4</span>
<span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">:</span>
    <span class="n">upper</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="n">varname</span><span class="p">],</span> <span class="p">[</span><span class="mf">84.13</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">15.86</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">med</span><span class="p">,</span><span class="n">rounding</span><span class="p">),</span> <span class="s1">&#39; + &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">med</span><span class="p">,</span><span class="n">rounding</span><span class="p">),</span> <span class="s1">&#39; - &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">med</span> <span class="o">-</span> <span class="n">lower</span><span class="p">,</span><span class="n">rounding</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
period :  15.3363  +  0.0002  -  0.0002
asini_pos :  44.9399  +  0.1817  -  0.1792
asini_neg :  -43.1641  +  0.1465  -  0.1441
phi :  0.5933  +  0.0084  -  0.0088
eccen :  0.4532  +  0.0023  -  0.0022
omega :  -0.2701  +  0.0076  -  0.0075
gammav :  -22.8639  +  0.1282  -  0.1298
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">asini_pos</span> <span class="o">*</span> <span class="n">psi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;logP_interval__&#39;: -0.05302221292474968,
 &#39;phi_angle__&#39;: array([2.38077305, 3.50810861]),
 &#39;logs_lc&#39;: 1.503106224196015,
 &#39;asini_pos&#39;: 44.947949539218946,
 &#39;asini_neg&#39;: -43.173468198233785,
 &#39;mean&#39;: 0.003932298023283192,
 &#39;omega_angle__&#39;: array([-1.33818057,  4.99958407]),
 &#39;eccen_interval__&#39;: -0.19096305685863374,
 &#39;lognu_pos&#39;: array([2.63530587, 2.65347761]),
 &#39;lognu_neg&#39;: array([2.75259784, 2.52192862, 2.55649459, 2.85099771]),
 &#39;logs_RV_a&#39;: 0.11236832140087478,
 &#39;logs_RV_b&#39;: -0.3777195088913156,
 &#39;gammav&#39;: -22.825830993916206,
 &#39;logP&#39;: 2.7302155683426648,
 &#39;period&#39;: 15.336192661233353,
 &#39;phi&#39;: 0.5962519902387579,
 &#39;omega&#39;: -0.2615280360501543,
 &#39;eccen&#39;: 0.45195138464403606,
 &#39;nu_pos&#39;: array([13.94757791, 14.20334656]),
 &#39;nu_neg&#39;: array([15.68332182, 12.45258985, 12.89055135, 17.3050386 ])}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">3.33333</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="mf">2.06</span><span class="p">])</span>

<span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">samp</span> <span class="ow">in</span> <span class="n">xo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_samples_from_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
        <span class="n">taumod_pos</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">asini_pos</span> <span class="o">*</span> <span class="n">psi</span><span class="p">,</span> <span class="n">samp</span><span class="p">)</span>
        <span class="n">taumod_neg</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">asini_neg</span> <span class="o">*</span> <span class="n">psi</span><span class="p">,</span> <span class="n">samp</span><span class="p">)</span>
        <span class="n">ttime</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">%</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>

        <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ttime</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ttime</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="p">(</span><span class="n">taumod_pos</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">taumod_pos</span><span class="p">))[</span><span class="n">sort</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ttime</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="p">(</span><span class="n">taumod_neg</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">taumod_neg</span><span class="p">))[</span><span class="n">sort</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">orange</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fold_time</span> <span class="o">=</span> <span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">%</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>
        <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fold_time</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_a</span><span class="p">,</span> <span class="n">samp</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_b</span><span class="p">,</span> <span class="n">samp</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">orange</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rv_jd_b</span> <span class="o">%</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_b</span><span class="p">,</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="mf">0.91372549</span><span class="p">,</span> <span class="mf">0.36862745</span><span class="p">,</span> <span class="mf">0.05098039</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">samp</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_a</span><span class="p">,</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span>  <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="mf">0.21568627</span><span class="p">,</span> <span class="mf">0.52941176</span><span class="p">,</span> <span class="mf">0.75424837</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Orbital phase&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Time delay (s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RV (km/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
<span class="c1"># plt.savefig(overleaf_path + &#39;10080943.png&#39;, dpi=300, bbox_inches=&#39;tight&#39;, pad_inches=0)</span>

<span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">)</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_a</span><span class="p">)</span>

<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_b</span><span class="p">)</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-22-279db66669bf&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> <span class="ansi-green-fg">with</span> pb2_model_RV<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>     <span class="ansi-green-fg">for</span> samp <span class="ansi-green-fg">in</span> xo<span class="ansi-blue-fg">.</span>utils<span class="ansi-blue-fg">.</span>get_samples_from_trace<span class="ansi-blue-fg">(</span>trace<span class="ansi-blue-fg">,</span> size<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 10</span><span class="ansi-red-fg">         </span>taumod_pos <span class="ansi-blue-fg">=</span> xo<span class="ansi-blue-fg">.</span>eval_in_model<span class="ansi-blue-fg">(</span>asini_pos <span class="ansi-blue-fg">*</span> psi<span class="ansi-blue-fg">,</span> samp<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>         taumod_neg <span class="ansi-blue-fg">=</span> xo<span class="ansi-blue-fg">.</span>eval_in_model<span class="ansi-blue-fg">(</span>asini_neg <span class="ansi-blue-fg">*</span> psi<span class="ansi-blue-fg">,</span> samp<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span>         ttime <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">%</span> samp<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;period&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">/</span> samp<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;period&#39;</span><span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/exoplanet/utils.py</span> in <span class="ansi-cyan-fg">eval_in_model</span><span class="ansi-blue-fg">(var, point, return_func, model, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span>     <span class="ansi-green-fg">if</span> return_func<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>         <span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> func<span class="ansi-blue-fg">,</span> args
<span class="ansi-green-fg">---&gt; 76</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     77</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/theano/compile/function_module.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    811</span>                         s.storage[0] = s.type.filter(
<span class="ansi-green-intense-fg ansi-bold">    812</span>                             arg<span class="ansi-blue-fg">,</span> strict<span class="ansi-blue-fg">=</span>s<span class="ansi-blue-fg">.</span>strict<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 813</span><span class="ansi-red-fg">                             allow_downcast=s.allow_downcast)
</span><span class="ansi-green-intense-fg ansi-bold">    814</span>
<span class="ansi-green-intense-fg ansi-bold">    815</span>                     <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/theano/tensor/type.py</span> in <span class="ansi-cyan-fg">filter</span><span class="ansi-blue-fg">(self, data, strict, allow_downcast)</span>
<span class="ansi-green-intense-fg ansi-bold">    193</span>             <span class="ansi-green-fg">if</span> b <span class="ansi-green-fg">and</span> data<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">!=</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    194</span>                 raise TypeError(&#34;Non-unit value on shape on a broadcastable&#34;
<span class="ansi-green-fg">--&gt; 195</span><span class="ansi-red-fg">                                 &#34; dimension.&#34;, data.shape, self.broadcastable)
</span><span class="ansi-green-intense-fg ansi-bold">    196</span>             i <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">    197</span>         if (self.filter_checks_isfinite and

<span class="ansi-red-fg">TypeError</span>: (&#39;Bad input argument to theano function with name &#34;/Users/danielhey/anaconda3/lib/python3.7/site-packages/exoplanet/utils.py:46&#34; at index 8 (0-based). &#39;, &#39;Non-unit value on shape on a broadcastable dimension.&#39;, (2,), (True,))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/case_studies_10080943_78_1.png" src="../_images/case_studies_10080943_78_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">unique_colors</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.67189542, 0.81437908, 0.90065359],
       [0.21568627, 0.52941176, 0.75424837]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">orange</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;#ff7f00&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_jd_a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>

<span class="k">with</span> <span class="n">pb2_model_RV</span><span class="p">:</span>

    <span class="n">fold_time</span> <span class="o">=</span> <span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fold_time</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_a</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_a</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_a</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_time</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">xo</span><span class="o">.</span><span class="n">eval_in_model</span><span class="p">(</span><span class="n">rv_vrad_b</span><span class="p">,</span> <span class="n">map_params</span><span class="p">)[</span><span class="n">sort</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rv_jd_b</span> <span class="o">%</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">map_params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">rv_rv_b</span><span class="p">)</span>


<span class="n">rv_time_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_a</span><span class="p">)</span>
<span class="n">rv_rv_tensor_a</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_a</span><span class="p">)</span>

<span class="n">rv_time_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_jd_b</span><span class="p">)</span>
<span class="n">rv_rv_tensor_b</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">rv_rv_b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$3086663.1 \; \mathrm{km}$</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/maelstrom.html" class="btn btn-neutral float-right" title="Maelstrom" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="6780873.html" class="btn btn-neutral float-left" title="KIC 6780873" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Daniel Hey

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-144184844-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>